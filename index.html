<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Uso do Cart√£o Clara na Loja</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonte -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap"
        rel="stylesheet"
    />

    <style>
        body {
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
            background-color: #f8fafc;
        }

        /* bolhas */
        .user-bubble {
            background-color: #0ea5e9; /* sky-500 */
            color: #fff;
            border-radius: 1rem;
            border-bottom-right-radius: 0.25rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.25);
        }
        .bot-bubble {
            background-color: #ffffff;
            border-radius: 1rem;
            border-bottom-left-radius: 0.25rem;
            border: 1px solid rgb(226 232 240 / 1); /* slate-200 */
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07);
        }

        /* avatar Clara */
        .bot-avatar {
            background-color: #0ea5e9;
            color: #fff;
        }

        /* "digitando..." */
        .typing-bubble {
            background-color: #ffffff;
            border-radius: 1rem;
            border-bottom-left-radius: 0.25rem;
            border: 1px solid rgb(226 232 240 / 1);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07);
            font-size: 13px;
            color: #475569;
        }
        .dot {
            width: 6px;
            height: 6px;
            background-color: #475569;
            border-radius: 9999px;
            display: inline-block;
            animation: bounce 1.2s infinite;
        }
        .dot:nth-child(2) { animation-delay: 0.15s; }
        .dot:nth-child(3) { animation-delay: 0.3s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: translateY(0); opacity: 0.4; }
            40% { transform: translateY(-4px); opacity: 1; }
        }

        /* scrollbar da janela de chat */
        #chatWindow::-webkit-scrollbar {
            width: 6px;
        }
        #chatWindow::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 9999px;
        }
        #chatWindow::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 9999px;
        }

        /* estilinho pra link dentro da resposta do bot */
        .bot-link {
            color: #0ea5e9;
            font-weight: 600;
            text-decoration: underline;
            word-break: break-all;
        }
    </style>
</head>
<body class="text-slate-800 flex items-center justify-center min-h-screen p-4">

    <main class="w-full max-w-4xl bg-white rounded-2xl shadow-xl border border-slate-200 flex flex-col max-h-[90vh]">
        <!-- Header -->
        <header class="px-5 py-4 border-b border-slate-200 flex flex-col md:flex-row md:items-start md:justify-between gap-4">
            <div class="flex items-start gap-3">
                <div class="w-12 h-12 rounded-xl bot-avatar flex items-center justify-center font-bold text-lg shadow-md">
                    C
                </div>
                <div class="leading-tight">
                    <p class="font-semibold text-slate-800 text-base md:text-lg align-items: center">
                        Agente Clara | Grupo SBF
                    </p>
                    <p class="text-[12px] text-slate-500">
                        Pergunte sobre o uso do cart√£o Clara nas lojas.
                    </p>
                    <p class="text-[11px] text-slate-400 italic mt-1">
                        Ex: "Posso comprar micro-ondas?" ‚Ä¢ "Uber pode?" ‚Ä¢ "Travou o cart√£o, fa√ßo o qu√™?"
                    </p>
                </div>
            </div>

            <div class="text-[11px] text-slate-500 leading-snug md:text-right">
                <p class="font-semibold text-slate-700">Prazo de presta√ß√£o de contas:</p>
                <p>At√© 48h pra anexar nota fiscal, escolher etiqueta e descrever o gasto.</p>
                <p class="text-[10px] text-slate-400 mt-1">
                    Falha na presta√ß√£o no prazo pode bloquear o cart√£o preventivamente.
                </p>
            </div>
        </header>

        <!-- Chat window -->
        <section id="chatWindow" class="flex-1 overflow-y-auto px-5 py-4 space-y-4 text-[15px] leading-relaxed bg-slate-50/40">

            <!-- Mensagem inicial da Clara -->
            <div class="flex items-start gap-3">
                <div class="w-9 h-9 rounded-xl bot-avatar flex items-center justify-center font-bold text-sm shadow-md flex-shrink-0">
                    C
                </div>
                <div class="bot-bubble px-4 py-3 max-w-[80%]">
                    <p class="font-semibold text-slate-800">
                        Ol√°! üëã Eu sou a Clara.
                    </p>
                    <p class="text-slate-700 text-sm mt-1">
                        Me pergunta coisas tipo:
                        <br>‚Ä¢ "Posso pagar Uber?"
                        <br>‚Ä¢ "Deu bloqueio, o que eu fa√ßo?"
                        <br>‚Ä¢ "Como justificar a compra na Clara?"
                        <br>‚Ä¢ "Como abro chamado no ServiceNow?"
                        <br>‚Ä¢ "Me manda a pol√≠tica em PDF."
                    </p>
                    <p class="text-[11px] text-slate-400 italic mt-3">
                        Minhas respostas seguem a Pol√≠tica de Uso dos Cart√µes Clara. Em conflito, vale sempre o documento oficial da empresa.
                    </p>
                </div>
            </div>
        </section>

        <!-- √Årea de input -->
        <section class="border-t border-slate-200 bg-white rounded-b-2xl px-4 py-4 flex flex-col gap-3">
            <form id="chatForm" class="flex w-full gap-3">
                <input
                    id="userInput"
                    type="text"
                    class="flex-1 text-[15px] border border-slate-300 rounded-xl px-3 py-3 outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500"
                    placeholder="Escreve sua d√∫vida (ex: Como justificar a transa√ß√£o?)"
                    autocomplete="off"
                />
                <button
                    class="bg-sky-500 hover:bg-sky-600 text-white font-semibold text-sm rounded-xl px-4 py-3 shadow-md transition"
                    type="submit"
                >
                    Enviar
                </button>
            </form>

            <div class="text-[11px] text-slate-500 text-center leading-snug">
            </div>
        </section>
    </main>

    <script>
        //
        // CONFIG FIXA
        //
        const SERVICE_NOW_URL = "https://sn.gruposbf.com.br/sp?id=ticket&is_new_order=true&table=incident&sys_id=52d2e0ef1b06e1907540a6cae54bcbe6"; 
        const POLITICA_PDF_URL = "https://drive.google.com/file/d/1pDftfaJOPUra0-0gAeK2ziJ3llyscvjx/view?usp=sharing";


        //
        // INTEN√á√ïES / PALAVRAS-CHAVE
        //
        const categorias = {
            eletronicos: [
                "ps5","playstation","play station","xbox",
                "tv","televisao","televis√£o","monitor","som","r√°dio","radio",
                "caixa de som","soundbar","notebook","laptop","tablet","fone","headset"
            ],
            eletrodomesticos: [
                "micro-ondas","microondas","micro ondas",
                "geladeira","frigobar","cafeteira","cafeteria","cafeteirinha",
                "bebedouro","airfryer","aspirador"
            ],
            alimentosEquipe: [
                "lanche","cafe","caf√©","refei√ß√£o","refeicao","almo√ßo","almoco","pizza","refrigerante",
                "√°gua","agua","coffee break","lanche do time","lanche da equipe",
                "time vm","vm","treinamento","treinamento interno","visita diretor","visita regional"
            ],
            transporte: [
                "uber","99","app de transporte","corrida","taxi","t√°xi","viagem","passagem","passagens"
            ],
            manutencaoLoja: [
                "chaveiro","fechadura","troca de tomada","tomada","manuten√ß√£o ar",
                "manutencao ar","ar condicionado","ar-condicionado","conserto geladeira da loja",
                "arrumar porta","arrumar vitrine","motoboy","frete","frete urgente","entrega urgente","courier"
            ],
            bloqueio: [
                "bloqueou","bloqueio","bloqueada","cart√£o bloqueado","cartao bloqueado",
                "desbloquear","desbloqueia","desbloqueio","como desbloquear",
                "travou","cart√£o travou","cartao travou","preventivo"
            ],
            prazo: [
                "48h","48 horas","prazo","quanto tempo","deadline",
                "prestar contas","presta√ß√£o de contas","prestacao de contas","quando preciso lan√ßar","ate quando lan√ßo"
            ],
            justificar: [
                "como justificar","justificar compra","justificar transa√ß√£o","justificar a transa√ß√£o",
                "prestar conta","presta√ß√£o de contas","prestacao de contas",
                "o que eu coloco na descri√ß√£o","o que tenho que anexar","o que precisa lan√ßar na clara",
                "o que tenho que lan√ßar"
            ],
            emergencial: [
                "emerg√™ncia","emergencia","urgente","sangria",
                "tirar dinheiro do caixa","pegar dinheiro do caixa","sem limite","acabou limite","limite acabou","estourou limite"
            ],
            pessoal: [
                "usei pra mim","pra mim","comprei pra mim",
                "gasto pessoal","despesa pessoal","roupa pro meu filho","comprei um body pro meu filho","pessoal"
            ],
            outraLoja: [
                "cart√£o de outra loja","cartao de outra loja","emprestado",
                "usar cart√£o da outra loja","usar cartao da outra loja",
                "gerente desligado","sem gerente","sem cart√£o","sem cartao",
                "mudan√ßa de gerente","mudanca de gerente","troca de gerente"
            ],
            notaFiscal: [
                "guardar nota","nota fisica","nota fiscal fisica","nota fiscal f√≠sica",
                "comprovante fisico","comprovante f√≠sico","auditoria","180 dias","guardar comprovante"
            ],
            servicenow: [
                "servicenow","service now","abre chamado","abrir chamado","abrir um chamado",
                "chamado de aumento de limite","chamado de limite","chamado desbloqueio",
                "desbloqueio no servicenow","categoria nova","nova etiqueta","nova categoria",
                "troca de gerente","mudan√ßa de gerente","mudanca de gerente","transferir gerente",
                "cart√£o bloqueado preciso abrir chamado","cartao bloqueado preciso abrir chamado",
                "o que posso abrir no servicenow","quais chamados posso abrir"
            ],
            politicaPdf: [
                "me manda a pol√≠tica","me manda a politica","manda a pol√≠tica","manda a politica",
                "pdf da politica","pdf da pol√≠tica","politica clara","pol√≠tica clara",
                "documento oficial","politica completa","politica em pdf","politica de uso"
            ]
        };


        //
        // RESPOSTAS POR INTEN√á√ÉO
        //
        function respostaEletronicos() {
            return (
`N√£o, esse tipo de compra n√£o pode ser feito com o cart√£o Clara. üò¨

Itens como videogame (PS5), TV, r√°dio, caixa de som, notebook etc. s√£o considerados eletr√¥nico / bem patrimonial da empresa. Isso segue fluxo de Compras, n√£o cart√£o da loja.

Caminho certo:
‚Üí Solicitar via Compras / ServiceNow, n√£o passar direto no cart√£o Clara.`
            );
        }

        function respostaEletrodomesticos() {
            return (
`Micro-ondas, geladeira, frigobar, cafeteira, bebedouro... tamb√©m n√£o entram no cart√£o Clara.

Esses itens s√£o infraestrutura/equipamento fixo de loja e precisam seguir o fluxo de Compras.

‚ö† Se j√° passou no cart√£o sem querer:
1. avisa o Financeiro,
2. classifica na plataforma como "Despesa Pessoal ‚Äì Uso Indevido",
3. faz o ressarcimento em at√© 2 dias √∫teis.`
            );
        }

        function respostaAlimentosEquipe() {
            return (
`Depende üëá

‚úî Pode:
Lanche / √°gua / caf√© / coffee break para treinamento interno autorizado, a√ß√£o oficial na loja (VM, regional, diretoria) ou evento operacional aprovado.

‚ùå N√£o pode:
Almo√ßo pessoal, pipoca no cinema, comida de lazer.

Quando pode, tem que lan√ßar assim:
‚Ä¢ Anexa a nota fiscal
‚Ä¢ Usa a etiqueta correta
‚Ä¢ Descreve: "Coffee break treinamento VM loja 1234".`
            );
        }

        function respostaTransporte() {
            return (
`Uber / 99 / t√°xi pra deslocamento pessoal n√£o pode no cart√£o Clara.

Isso n√£o √© despesa operacional direta da loja.

Se j√° pagou com o cart√£o:
‚Üí avisa Financeiro
‚Üí ressarce o valor.`
            );
        }

        function respostaManutencao() {
            return (
`Esses gastos normalmente PODEM ir no cart√£o Clara, porque s√£o operacionais da loja. üí°

Exemplos aceit√°veis:
‚Ä¢ chaveiro emergencial (trocar fechadura de estoque/cofre/vitrine),
‚Ä¢ troca de tomada simples,
‚Ä¢ reparo leve de ar-condicionado,
‚Ä¢ motoboy / frete urgente pra levar item cr√≠tico entre lojas.

Mas sempre:
- Nota fiscal anexada,
- Etiqueta correta,
- Descri√ß√£o clara: "Chaveiro emergencial - troca fechadura estoque loja 1234".`
            );
        }

        function respostaBloqueio() {
            return (
`Isso √© bloqueio preventivo. üîí

O cart√£o pode travar se a compra n√£o foi prestada conta no prazo de 48h.

Prestar conta = anexar nota fiscal/recibo + escolher etiqueta correta + descrever o motivo da compra.

Pra resolver:
1. Corrige tudo na plataforma Clara (nota, etiqueta, descri√ß√£o),
2. Abre chamado no ServiceNow para o Financeiro / Contas a Receber pedindo desbloqueio.

No chamado escreve:
"Cart√£o bloqueado preventivamente. Presta√ß√£o de contas regularizada. Solicito desbloqueio."

Link: ${SERVICE_NOW_URL}

Importante:
‚Üí Pode bloquear independente do valor.
‚Üí Se repetir demais, a loja pode perder o direito do cart√£o.`
            );
        }

        function respostaPrazo() {
            return (
`Prazo oficial ‚è±

Voc√™ tem at√© 48 horas depois da compra pra:
‚Ä¢ anexar nota fiscal/recibo,
‚Ä¢ escolher a etiqueta certa,
‚Ä¢ escrever a descri√ß√£o explicando o motivo do gasto.

Se passar disso, o cart√£o pode ser bloqueado preventivamente at√© voc√™ regularizar.`
            );
        }

        // NOVA: explica√ß√£o de "como justificar"
        function respostaJustificar() {
            return (
`Pra justificar / prestar contas de uma compra na Clara voc√™ precisa fazer 3 coisas dentro de at√© 48h depois da compra:

1. Anexar o comprovante fiscal
   - nota fiscal ou recibo da compra.

2. Escolher a etiqueta certa
   - √© a categoria do gasto (Marketing, Material de Limpeza, Chaveiro Emergencial, etc.).
   - se a etiqueta n√£o existir, voc√™ pede cria√ß√£o abrindo chamado no ServiceNow.

3. Preencher a descri√ß√£o
   - escrever em texto curto o motivo da compra.
   - exemplo bom: "Chaveiro emergencial - troca fechadura estoque loja 1234".
   - exemplo ruim: "servi√ßo".

Se isso n√£o estiver completo no prazo, o cart√£o pode ser bloqueado preventivamente at√© regularizar.`
            );
        }

        function respostaEmergencia() {
            return (
`"Emerg√™ncia" N√ÉO √© "acabou o limite". üòÖ

√â emerg√™ncia real quando:
1. a loja n√£o consegue operar sem aquele gasto AGORA
E
2. n√£o tem como usar o cart√£o Clara (ex.: pane t√©cnica).

O que fazer:
‚Üí Antes de pagar de outro jeito ou tirar dinheiro do caixa,
   abre chamado no ServiceNow pedindo autoriza√ß√£o excepcional do Financeiro.

No chamado escreve:
"Solicita√ß√£o de exce√ß√£o emergencial para despesa operacional imediata. Motivo: (explicar o risco operacional)".

Sem autoriza√ß√£o PR√âVIA, n√£o pode tirar dinheiro do caixa e resolver depois.`
            );
        }

        function respostaPessoal() {
            return (
`Uso pessoal do cart√£o √© proibido. Mas d√° pra corrigir se voc√™ avisar na hora.

Passo a passo:
1. avisa o Financeiro,
2. marca na plataforma como "Despesa Pessoal ‚Äì Uso Indevido",
3. devolve o valor em at√© 2 dias √∫teis.

Se voc√™ n√£o ressarcir:
‚Ä¢ pode ter desconto em folha (art. 462 CLT),
‚Ä¢ pode gerar medida disciplinar,
‚Ä¢ e o cart√£o pode ser bloqueado definitivamente.`
            );
        }

        function respostaOutraLoja() {
            return (
`Usar cart√£o de outra loja s√≥ pode em cen√°rio bem espec√≠fico:

‚Ä¢ O gerente titular saiu e ainda n√£o criaram um cart√£o novo pra loja,
‚Ä¢ O Financeiro autorizou esse uso tempor√°rio,
‚Ä¢ Voc√™ est√° cobrindo essa gest√£o.

Obrigat√≥rio:
Na descri√ß√£o da compra voc√™ escreve:
"Uso tempor√°rio do cart√£o na loja XXXX".

Mudan√ßa de gerente / troca de respons√°vel pelo cart√£o tamb√©m precisa ser formalizada:
‚Üí abre chamado no ServiceNow pra atualizar o respons√°vel oficial e manter controle/auditoria.`
            );
        }

        function respostaNotaFiscal() {
            return (
`Mesmo depois de subir a nota fiscal/recibo na plataforma Clara, a loja precisa guardar o documento f√≠sico original.

Prazo: manter guardado por 180 dias corridos. üóÇ
Auditoria pode pedir o papel original.`
            );
        }

        // ServiceNow geral (o que pode abrir)
        function respostaServiceNowGeral() {
            return (
`Esses s√£o os casos que precisam de chamado no ServiceNow üëá

‚Ä¢ Desbloqueio do cart√£o Clara
  ‚Üí Tipo: Financeiro / Contas a Receber
  ‚Üí Mensagem: "Cart√£o bloqueado preventivamente. Presta√ß√£o de contas regularizada. Solicito desbloqueio."

‚Ä¢ Aumento de limite
  ‚Üí Tipo: Financeiro
  ‚Üí Mensagem: "Solicita√ß√£o de aumento de limite para despesas operacionais da loja XXXX. Justificativa: ____."

‚Ä¢ Troca de gerente / mudan√ßa de respons√°vel pelo cart√£o entre lojas
  ‚Üí Tipo: Cadastro / Financeiro
  ‚Üí Mensagem: "Atualiza√ß√£o de respons√°vel pelo cart√£o Clara: gerente anterior desligado / novo respons√°vel assumindo a loja XXXX."

‚Ä¢ Criar nova etiqueta/categoria de gasto que n√£o existe na Clara
  ‚Üí Tipo: Financeiro / Cont√°bil
  ‚Üí Mensagem: "Solicitar inclus√£o de etiqueta para despesa operacional (descrever o gasto)."

‚Ä¢ Situa√ß√£o emergencial real em que n√£o d√° pra usar o cart√£o e a loja precisa pagar algo essencial pra operar
  ‚Üí Tipo: Financeiro
  ‚Üí Mensagem: "Solicita√ß√£o de exce√ß√£o emergencial para despesa operacional imediata."

Link para abrir chamado:
${SERVICE_NOW_URL}

Sempre abre chamado ANTES de improvisar (ex.: tirar dinheiro do caixa).`
            );
        }

        // ServiceNow contextual
        function respostaServiceNowContextual(msgNorm) {
            if (
                msgNorm.includes("desbloque") ||
                msgNorm.includes("bloqueou") ||
                msgNorm.includes("bloqueio") ||
                msgNorm.includes("cartao travou") ||
                msgNorm.includes("cartao bloqueado") ||
                msgNorm.includes("como desbloquear")
            ) {
                return (
`Seu cart√£o travou? üîí

1. Corrige na Clara o que faltou: nota fiscal anexada, etiqueta certa e descri√ß√£o clara.
2. Depois abre chamado no ServiceNow para o Financeiro / Contas a Receber.

Escreve no chamado:
"Cart√£o bloqueado preventivamente. Presta√ß√£o de contas regularizada. Solicito desbloqueio."

Link:
${SERVICE_NOW_URL}`
                );
            }

            if (
                msgNorm.includes("etiqueta") ||
                msgNorm.includes("categoria nova") ||
                msgNorm.includes("nova categoria")
            ) {
                return (
`Quer usar uma categoria de gasto que ainda n√£o existe na Clara?

‚Üí Abre chamado no ServiceNow para Financeiro / Cont√°bil pedindo cria√ß√£o de etiqueta.

No chamado coloca:
"Solicitar inclus√£o de etiqueta para despesa operacional da loja. Descri√ß√£o: ____."

Link:
${SERVICE_NOW_URL}`
                );
            }

            if (
                msgNorm.includes("troca de gerente") ||
                msgNorm.includes("mudanca de gerente") ||
                msgNorm.includes("mudan√ßa de gerente") ||
                msgNorm.includes("gerente desligado") ||
                msgNorm.includes("sem gerente")
            ) {
                return (
`Mudou o respons√°vel pelo cart√£o da loja?

‚Üí Precisa abrir chamado no ServiceNow pra atualizar oficialmente quem responde pelo cart√£o.

Mensagem sugerida:
"Atualiza√ß√£o de respons√°vel pelo cart√£o Clara: gerente anterior desligado / novo respons√°vel assumindo a loja XXXX."

Isso garante controle, auditoria e quem presta contas.

Link:
${SERVICE_NOW_URL}`
                );
            }

            if (
                msgNorm.includes("limite") ||
                msgNorm.includes("aumento de limite") ||
                msgNorm.includes("limite maior")
            ) {
                return (
`Precisa de aumento de limite do cart√£o?

‚Üí Abre chamado no ServiceNow para Financeiro.

Mensagem sugerida:
"Solicita√ß√£o de aumento de limite para despesas operacionais da loja XXXX. Justificativa: ____."

Lembrando: limite √© pra despesa operacional da loja, n√£o uso pessoal.

Link:
${SERVICE_NOW_URL}`
                );
            }

            if (
                msgNorm.includes("emergencia") ||
                msgNorm.includes("emerg√™ncia") ||
                msgNorm.includes("urgente") ||
                msgNorm.includes("sangria") ||
                msgNorm.includes("tirar dinheiro do caixa") ||
                msgNorm.includes("pegar dinheiro do caixa")
            ) {
                return (
`Situa√ß√£o emergencial REAL √© quando:
1. a loja n√£o consegue operar sem aquele gasto agora
e
2. n√£o d√° pra usar o cart√£o Clara.

Antes de pagar de outro jeito:
‚Üí Abre chamado no ServiceNow pedindo autoriza√ß√£o excepcional do Financeiro.

Mensagem sugerida:
"Solicita√ß√£o de exce√ß√£o emergencial para despesa operacional imediata. Motivo: ____."

Link:
${SERVICE_NOW_URL}

Sem autoriza√ß√£o PR√âVIA, n√£o pode tirar dinheiro do caixa e 'resolver depois'.`
                );
            }

            return respostaServiceNowGeral();
        }

        // Politica PDF com link clic√°vel
        function respostaPoliticaPDF() {
            return (
`HTML:<p>Segue a <strong>Pol√≠tica de Uso dos Cart√µes Clara</strong> (vers√£o oficial mais recente dispon√≠vel):<br>
<a class="bot-link" href="${POLITICA_PDF_URL}" target="_blank" rel="noopener noreferrer">${POLITICA_PDF_URL}</a>
</p>
<p class="mt-2 text-[13px] text-slate-500">
O documento traz: categorias permitidas, prazo de 48h pra presta√ß√£o de contas, bloqueio preventivo, responsabilidades e fluxo em caso de uso pessoal do cart√£o.
</p>`
            );
        }

        // fallback
        function respostaGenerica() {
            return (
`Vamos checar rapidinho üëá

1. A compra √© pra opera√ß√£o da LOJA ou √© algo pessoal?
2. Voc√™ tem/ter√° nota fiscal?
3. Voc√™ consegue anexar nota + escolher etiqueta + escrever o motivo em at√© 48h?

Se for gasto operacional da loja e voc√™ consegue justificar dentro de 48h na Clara, normalmente pode.
Se for item patrimonial (ex.: TV, PS5) ou pessoal, a√≠ n√£o pode no cart√£o Clara.`
            );
        }


        //
        // NORMALIZA√á√ÉO / CLASSIFICA√á√ÉO
        //
        function normalize(text) {
            return text
                .toLowerCase()
                .normalize("NFD")
                .replace(/[\u0300-\u036f]/g, "");
        }

        function hit(msgNorm, arr) {
            return arr.some(k => msgNorm.includes(normalize(k)));
        }

        function classificarPergunta(msg) {
            const m = normalize(msg);

            if (hit(m, categorias.politicaPdf))   return "politicaPdf";
            if (hit(m, categorias.servicenow))    return "servicenow";

            if (hit(m, categorias.bloqueio))      return "bloqueio";
            if (hit(m, categorias.justificar))    return "justificar";

            if (hit(m, categorias.eletronicos))      return "eletronicos";
            if (hit(m, categorias.eletrodomesticos)) return "eletrodomesticos";
            if (hit(m, categorias.alimentosEquipe))  return "alimentosEquipe";
            if (hit(m, categorias.transporte))       return "transporte";
            if (hit(m, categorias.manutencaoLoja))   return "manutencaoLoja";
            if (hit(m, categorias.prazo))            return "prazo";
            if (hit(m, categorias.emergencial))      return "emergencia";
            if (hit(m, categorias.pessoal))          return "pessoal";
            if (hit(m, categorias.outraLoja))        return "outraLoja";
            if (hit(m, categorias.notaFiscal))       return "notaFiscal";

            return "generica";
        }

        function gerarResposta(msg) {
            const tipo = classificarPergunta(msg);
            const msgNorm = normalize(msg);

            switch (tipo) {
                case "eletronicos":      return respostaEletronicos();
                case "eletrodomesticos": return respostaEletrodomesticos();
                case "alimentosEquipe":  return respostaAlimentosEquipe();
                case "transporte":       return respostaTransporte();
                case "manutencaoLoja":   return respostaManutencao();
                case "bloqueio":         return respostaBloqueio();
                case "prazo":            return respostaPrazo();
                case "justificar":       return respostaJustificar();
                case "emergencia":       return respostaEmergencia();
                case "pessoal":          return respostaPessoal();
                case "outraLoja":        return respostaOutraLoja();
                case "notaFiscal":       return respostaNotaFiscal();

                case "servicenow":       return respostaServiceNowContextual(msgNorm);
                case "politicaPdf":      return respostaPoliticaPDF();

                default:                 return respostaGenerica();
            }
        }


        //
        // RENDER DO CHAT
        //
        const chatWindow = document.getElementById("chatWindow");
        const chatForm = document.getElementById("chatForm");
        const userInput = document.getElementById("userInput");

        function renderUserMessage(text) {
            const wrapper = document.createElement("div");
            wrapper.className = "flex items-start gap-3 justify-end";

            const bubble = document.createElement("div");
            bubble.className = "user-bubble px-4 py-3 max-w-[80%] text-sm whitespace-pre-line";
            bubble.innerText = text;

            wrapper.appendChild(bubble);
            chatWindow.appendChild(wrapper);
        }

        function renderTyping() {
            const wrapper = document.createElement("div");
            wrapper.className = "flex items-start gap-3 clara-typing";

            const avatar = document.createElement("div");
            avatar.className = "w-9 h-9 rounded-xl bot-avatar flex items-center justify-center font-bold text-sm shadow-md flex-shrink-0";
            avatar.innerText = "C";

            const bubble = document.createElement("div");
            bubble.className = "typing-bubble px-4 py-3 max-w-[80%] text-[13px]";
            bubble.innerHTML = `
                <span class="dot"></span>
                <span class="dot ml-1"></span>
                <span class="dot ml-1"></span>
                <span class="ml-2 text-slate-500">digitando...</span>
            `;

            wrapper.appendChild(avatar);
            wrapper.appendChild(bubble);

            chatWindow.appendChild(wrapper);
            scrollToBottom();

            return wrapper;
        }

        // <-- AQUI A GENTE ATUALIZA: agora aceita HTML
        function renderBotMessage(text) {
            const wrapper = document.createElement("div");
            wrapper.className = "flex items-start gap-3";

            const avatar = document.createElement("div");
            avatar.className = "w-9 h-9 rounded-xl bot-avatar flex items-center justify-center font-bold text-sm shadow-md flex-shrink-0";
            avatar.innerText = "C";

            const bubble = document.createElement("div");
            bubble.className = "bot-bubble px-4 py-3 max-w-[80%] text-sm whitespace-pre-line text-slate-700";

            // Se a resposta come√ßar com "HTML:", renderiza como HTML
            if (text.startsWith("HTML:")) {
                bubble.innerHTML = text.replace(/^HTML:/, "").trim();
            } else {
                bubble.innerText = text;
            }

            wrapper.appendChild(avatar);
            wrapper.appendChild(bubble);

            chatWindow.appendChild(wrapper);
        }

        function scrollToBottom() {
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        chatForm.addEventListener("submit", function (e) {
            e.preventDefault();
            const text = userInput.value.trim();
            if (!text) return;

            renderUserMessage(text);
            userInput.value = "";

            const typingEl = renderTyping();

            const answer = gerarResposta(text);

            setTimeout(() => {
                typingEl.remove();
                renderBotMessage(answer);
                scrollToBottom();
            }, 400);
        });
    </script>
</body>
</html>
