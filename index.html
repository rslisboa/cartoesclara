<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia Interativo: Pol√≠tica de Cart√£o da Clara</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Corporate Clarity -->
    <!-- Application Structure Plan: The SPA is designed as a user-friendly, thematic journey. It starts with a high-impact "Before vs. After" comparison to show value. It then presents a high-level process flowchart ("O Ciclo de Vida"). A central "Rules Dashboard" uses a table for allowed expenses and an icon-driven list for forbidden ones, facilitating quick understanding. The critical expense reporting process gets its own detailed flowchart section. Consequences are visualized with a bar chart for blocking criteria, making complex rules easy to grasp. A new section covers specific use cases for card usage during manager absences. A dedicated "Suporte" section is added for external help resources. A new "Pesquisa no Documento" section allows direct content search within the policy document. The app concludes with a practical, searchable table of all allowed expense categories from Annex I, acting as a quick-reference tool. This structure prioritizes user task-flow and comprehension over the report's linear chapter format. -->
    <!-- Visualization & Content Choices:
        - Report Info: Before vs. After (Cash vs. Card). Goal: Inform. Justification=Directly compares the old vs. new system for immediate impact.
        - Report Info: Card Lifecycle. Goal: Organize. Justification=Best method to illustrate sequential processes like card lifecycle and reporting.
        - Report Info: Allowed Expense Categories. Goal: Compare/Inform. Justification=Provides clear, structured details for each category instead of a general proportion.
        - Report Info: Blocking Criteria. Goal: Compare. Justification=Intuitively compares urgency levels based on transaction value.
        - Report Info: Usage in Specific Situations (Absences). Goal: Organize/Inform. Justification=Clearly outlines rules and responsibilities for specific scenarios.
        - Report Info: Support/Help Resources. Goal: Inform. Justification=Provides direct access to external support.
        - Report Info: Document Search. Goal: Inform/Explore. Justification=Allows direct keyword search within the source document.
        - Report Info: Annex I Categories. Goal: Inform/Organize. Justification=Provides a practical quick-reference tool for users.
        All charts use Chart.js with Canvas rendering, and all diagrams are built with pure HTML and Tailwind CSS.
    -->
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f4f7fa; }
        .chart-container { position: relative; width: 100%; max-width: 400px; margin-left: auto; margin-right: auto; height: 350px; }
        .flow-step { transition: all 0.3s ease; }
        .flow-step:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .nav-button { transition: all 0.2s ease-in-out; }
        .nav-button.active { background-color: #0c4a6e; color: white; }
        .nav-button:not(.active):hover { background-color: #e0f2fe; }
        section { scroll-margin-top: 80px; }
        .search-result-item:hover {
            cursor: default; /* Changed from pointer as it's no longer clickable to show full section */
            background-color: #e0f2fe; /* light sky blue on hover */
            border-color: #93c5fd; /* blue-300 */
        }
        .policy-content-highlight {
            background-color: #fee300; /* Yellow highlight for search terms in full document */
            padding: 1px 0;
            border-radius: 2px;
        }
        .policy-section-anchor {
            display: block;
            visibility: hidden;
            height: 0;
            margin-top: -80px; /* Offset for sticky header */
            padding-top: 80px; /* Counteract margin-top for content below */
            pointer-events: none; /* Make it not clickable */
        }
        /* All text in the policy display should be black */
        #policyTextRendered p, #policyTextRendered h4, #policyTextRendered h5 {
            color: #000000; 
        }
        /* Titles and subtitles should be bold and black (no specific background color) */
        .policy-title {
            color: #000000; /* Black */
            font-weight: bold; /* Bold */
            /* Removed background-color, padding, border-radius */
            display: inline; /* To not break line if not needed */
        }
        /* Background for the displayed policy section after search should be white */
        #fullPolicyContentDisplay {
            background-color: #FFFFFF; /* White background */
        }
    </style>
</head>
<body class="text-slate-800">

    <header class="bg-white shadow-md sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-bold text-sky-900">Guia Interativo | Pol√≠tica de Cart√µes Clara</h1>
            <nav id="navbar" class="hidden md:flex space-x-2">
                <button data-target="intro" class="nav-button active text-sm font-semibold text-slate-700 px-3 py-2 rounded-md">In√≠cio</button>
                <button data-target="process" class="nav-button text-sm font-semibold text-slate-700 px-3 py-2 rounded-md">Processo</button>
                <button data-target="rules" class="nav-button text-sm font-semibold text-slate-700 px-3 py-2 rounded-md">Regras</button>
                <button data-target="consequences" class="nav-button text-sm font-semibold text-slate-700 px-3 py-2 rounded-md">Consequ√™ncias</button>
                <button data-target="situations" class="nav-button text-sm font-semibold text-slate-700 px-3 py-2 rounded-md">Situa√ß√µes Espec√≠ficas</button>
                <button data-target="support" class="nav-button text-sm font-semibold text-slate-700 px-3 py-2 rounded-md">Suporte</button>
                <button data-target="document-search" class="nav-button text-sm font-semibold text-slate-700 px-3 py-2 rounded-md">Pesquisa Documento</button>
                <button data-target="reference" class="nav-button text-sm font-semibold text-slate-700 px-3 py-2 rounded-md">Consulta R√°pida</button>
            </nav>
        </div>
    </header>

    <main class="container mx-auto p-4 md:p-8">

        <section id="intro" class="mb-20 text-center">
            <h2 class="text-4xl font-extrabold text-sky-900 mb-4">A Evolu√ß√£o da Gest√£o de Despesas</h2>
            <p class="text-lg text-slate-600 max-w-3xl mx-auto mb-12">Substitu√≠mos o arriscado processo de "sangria de caixa" por uma solu√ß√£o digital, √°gil e segura. Entenda a mudan√ßa.</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-5xl mx-auto">
                <div class="bg-rose-100/50 border-2 border-rose-200 rounded-xl p-6 shadow-sm">
                    <h3 class="text-2xl font-bold text-rose-800 mb-4">‚ùå Antes: Sangria de Caixa</h3>
                    <ul class="text-left space-y-3 text-rose-900">
                        <li class="flex items-start"><span class="text-xl mr-3">‚ö†Ô∏è</span><div><strong class="block">Alto Risco Operacional:</strong> Manuseio de dinheiro em esp√©cie, vulner√°vel a perdas e roubos.</div></li>
                        <li class="flex items-start"><span class="text-xl mr-3">üêå</span><div><strong class="block">Processos Manuais e Lentos:</b> Burocracia na solicita√ß√£o, aprova√ß√£o e concilia√ß√£o de despesas.</div></li>
                        <li class="flex items-start"><span class="text-xl mr-3">üìâ</span><div><strong class="block">Falta de Visibilidade:</b> Controle financeiro reativo, dificultando o rastreamento de gastos.</div></li>
                    </ul>
                </div>
                <div class="bg-sky-100/50 border-2 border-sky-200 rounded-xl p-6 shadow-sm">
                     <h3 class="text-2xl font-bold text-sky-800 mb-4">‚úÖ Agora: Cart√£o da Clara</h3>
                    <ul class="text-left space-y-3 text-sky-900">
                        <li class="flex items-start"><span class="text-xl mr-3">üõ°Ô∏è</span><div><strong class="block">Seguran√ßa e Controle:</strong> Transa√ß√µes digitais e limites predefinidos reduzem fraudes e perdas.</div></li>
                        <li class="flex items-start"><span class="text-xl mr-3">‚ö°Ô∏è</span><div><strong class="block">Agilidade e Efici√™ncia:</strong> Autonomia para os gerentes com processos simplificados na plataforma online.</div></li>
                        <li class="flex items-start"><span class="text-xl mr-3">üìä</span><div><strong class="block">Transpar√™ncia Total:</b> Monitoramento de despesas em tempo real, facilitando a gest√£o e auditoria.</div></li>
                    </ul>
                </div>
            </div>
            <!-- Novo comunicado adicionado aqui -->
            <div class="mt-12 p-6 bg-sky-50 border border-sky-300 rounded-lg text-slate-700 w-full max-w-6xl mx-auto shadow-sm">
                <p class="font-bold text-xl text-sky-900 mb-2 text-center uppercase">Importante!</p>
                <p class="text-center">Ap√≥s a implanta√ß√£o do cart√£o da Clara em cada loja e a confirma√ß√£o formal de recebimento, acompanhada do treinamento de uso da plataforma da Clara, o processo de sangria de despesas √© descontinuado para as unidades Centauro. Isso ocorre por meio do bloqueio simult√¢neo do PDV e do fluxo de solicita√ß√µes de sangrias na intranet, impedindo que a loja realize retiradas de dinheiro em esp√©cie para pagamento de despesas.</p>
            </div>
            <!-- Fim do novo comunicado -->
        </section>

        <section id="process" class="mb-20">
            <h2 class="text-3xl font-bold text-center mb-4 text-sky-900">O Ciclo de Vida do Cart√£o</h2>
            <p class="text-lg text-center text-slate-600 max-w-3xl mx-auto mb-12">Desde a sua emiss√£o at√© o monitoramento, o uso do cart√£o segue um fluxo claro para garantir controle e conformidade.</p>
            <div class="flex flex-col md:flex-row items-center justify-center gap-4 md:gap-0">
                <div class="flow-step text-center p-6 rounded-lg bg-white shadow-md border-t-4 border-sky-500 max-w-xs w-full">
                    <div class="text-5xl mb-3">1Ô∏è‚É£</div>
                    <h3 class="text-lg font-bold text-slate-900">Emiss√£o e Ativa√ß√£o</h3>
                    <p class="text-sm text-slate-600">O Financeiro emite o cart√£o. O gerente realiza um treinamento obrigat√≥rio e sua participa√ß√£o √© validada para ativar o uso.</p>
                </div>
                <div class="text-4xl text-sky-400 font-light hidden md:block mx-4">‚Üí</div>
                <div class="text-4xl text-sky-400 font-light block md:hidden my-4 transform rotate-90">‚Üí</div>
                <div class="flow-step text-center p-6 rounded-lg bg-white shadow-md border-t-4 border-sky-500 max-w-xs w-full">
                    <div class="text-5xl mb-3">2Ô∏è‚É£</div>
                    <h3 class="text-lg font-bold text-slate-900">Uso e Presta√ß√£o de Contas Essencial</h3>
                    <p class="text-sm text-slate-600">O cart√£o da Clara √© usado para despesas autorizadas. A **inser√ß√£o da etiqueta e da nota fiscal/recibo √© essencial** para cada compra na plataforma, em at√© 48h.</p>
                </div>
                <div class="text-4xl text-sky-400 font-light hidden md:block mx-4">‚Üí</div>
                 <div class="text-4xl text-sky-400 font-light block md:hidden my-4 transform rotate-90">‚Üí</div>
                <div class="flow-step text-center p-6 rounded-lg bg-white shadow-md border-t-4 border-sky-500 max-w-xs w-full">
                    <div class="text-5xl mb-3">3Ô∏è‚É£</div>
                    <h3 class="text-lg font-bold text-slate-900">Monitoramento e A√ß√£o</h3>
                    <p class="text-sm text-slate-600">O Financeiro monitora as transa√ß√µes e aplica bloqueios preventivos em caso de n√£o conformidade.</p>
                </div>
            </div>
        </section>

        <section id="rules" class="mb-20">
            <h2 class="text-3xl font-bold text-center mb-12 text-sky-900">Regras de Ouro: O Que Voc√™ Precisa Saber</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col">
                    <h3 class="text-xl font-bold text-center text-slate-900 mb-4">Gastos Permitidos</h3>
                    <p class="text-center text-sm text-slate-600 mb-6">O cart√£o deve ser usado exclusivamente para despesas operacionais da loja. Veja as categorias mais comuns.</p>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left text-sm text-slate-700">
                            <thead class="text-xs text-slate-900 uppercase bg-slate-100">
                                <tr>
                                    <th scope="col" class="py-3 px-6 rounded-tl-lg">Categoria</th>
                                    <th scope="col" class="py-3 px-6 rounded-tr-lg">Exemplos</th>
                                </tr>
                            </thead>
                            <tbody id="expenseTableMain">
                                <!-- Table rows will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-center text-slate-900 mb-4">Restri√ß√µes Cr√≠ticas</h3>
                    <p class="text-center text-sm text-slate-600 mb-6">O uso indevido do cart√£o √© uma falta grave. As seguintes despesas s√£o estritamente proibidas.</p>
                    <ul class="space-y-4 text-slate-700">
                        <li class="flex items-center p-4 bg-rose-50/80 rounded-lg border-l-4 border-rose-400"><span class="text-2xl mr-4">üö´</span><div><strong class="block">Despesas Pessoais:</strong> Qualquer compra para benef√≠cio pr√≥prio.</div></li>
                        <li class="flex items-center p-4 bg-rose-50/80 rounded-lg border-l-4 border-rose-400"><span class="text-2xl mr-4">üö´</span><div><strong class="block">Bens Patrimoniais:</strong> Compra de eletr√¥nicos ou m√≥veis. (Solicitar via Compras).</div></li>
                        <li class="flex items-center p-4 bg-rose-50/80 rounded-lg border-l-4 border-rose-400"><span class="text-2xl mr-4">üö´</span><div><strong class="block">Eletrodom√©sticos:</b> Compra de geladeiras, micro-ondas, bebedouros, etc.</div></li>
                        <li class="flex items-center p-4 bg-rose-50/80 rounded-lg border-l-4 border-rose-400"><span class="text-2xl mr-4">üö´</span><div><strong class="block">Saques e Adiantamentos:</b> Retirar dinheiro ou receber adiantamentos.</div></li>
                        <li class="flex items-center p-4 bg-rose-50/80 rounded-lg border-l-4 border-rose-400"><span class="text-2xl mr-4">üö´</span><div><strong class="block">Viagens e Transporte Pessoal:</b> Despesas com passagens e apps de mobilidade.</div></li>
                        <li class="flex items-center p-4 bg-rose-50/80 rounded-lg border-l-4 border-rose-400"><span class="text-2xl mr-4">üö´</span><div><strong class="block">Conflito de Interesses:</strong> Compras em empresas de familiares sem autoriza√ß√£o.</div></li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="consequences" class="mb-20">
            <h2 class="text-3xl font-bold text-center mb-12 text-sky-900">Monitoramento e Consequ√™ncias</h2>
             <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl shadow-lg p-6 flex flex-col">
                    <h3 class="text-xl font-bold text-center text-slate-900 mb-4">Crit√©rios para Bloqueio Preventivo</h3>
                    <p class="text-center text-sm text-slate-600 mb-6">A presta√ß√£o de contas dentro do prazo √© crucial. A urg√™ncia para regularizar varia com o valor da transa√ß√£o para mitigar riscos.</p>
                    <div class="chart-container flex-grow">
                        <canvas id="blockingCriteriaChart"></canvas>
                    </div>
                </div>

                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-center text-slate-900 mb-4">Procedimento em Caso de Uso Pessoal</h3>
                     <p class="text-center text-sm text-slate-600 mb-6">A transpar√™ncia √© valorizada, mas o uso indevido tem consequ√™ncias claras. Veja os dois cen√°rios poss√≠veis.</p>
                     <div class="flex flex-col h-full gap-4 mt-0 mb-8"> <!-- Adjusted margin-bottom for spacing -->
                         <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-center flex-grow">
                             <!-- Reconhecimento Espont√¢neo -->
                             <div class="flex flex-col justify-start">
                                 <h5 class="font-bold text-green-800 text-base">Reconhecimento Espont√¢neo</h5>
                                 <div class="w-full h-1 bg-green-300 my-2"></div> <!-- Horizontal line in green -->
                                 <p class="text-xs text-slate-600">Comunicar imediatamente o fato √† √°rea Financeira, classificar a transa√ß√£o na plataforma como "Despesa Pessoal - Uso Indevido" na descri√ß√£o, e providenciar o ressarcimento integral do valor √† empresa no prazo m√°ximo de 2 dias √∫teis a partir da data de comunica√ß√£o. Ap√≥s a regulariza√ß√£o, a situa√ß√£o ser√° avaliada para determinar a necessidade de orienta√ß√£o formal ao colaborador, como advert√™ncia ou outra medida disciplinar, ou revis√£o da autoriza√ß√£o de uso do cart√£o em caso de reincid√™ncia ou gravidade da conduta. A empresa valoriza a transpar√™ncia e o reconhecimento espont√¢neo, tratando as medidas corretivas com proporcionalidade.</p>
                             </div>
                             <!-- N√£o Reconhecimento -->
                              <div class="flex flex-col justify-start">
                                 <h5 class="font-bold text-red-800 text-base">N√£o Reconhecimento</h5>
                                 <div class="w-full h-1 bg-red-300 my-2"></div> <!-- Horizontal line in red -->
                                 <p class="text-xs text-slate-600">Caso a despesa pessoal seja identificada pela empresa, mas n√£o reconhecida ou n√£o ressarcida pelo respons√°vel, ser√£o adotadas medidas administrativas e legais cab√≠veis, incluindo desconto em folha, abertura de procedimento disciplinar e bloqueio definitivo do cart√£o da Clara.</p>
                             </div>
                         </div>
                     </div>
                </div>
            </div>
        </section>

        <section id="situations" class="mb-20 bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-3xl font-bold text-center mb-4 text-sky-900">Uso do Cart√£o em Situa√ß√µes Espec√≠ficas</h2>
            <p class="text-lg text-center text-slate-600 max-w-3xl mx-auto mb-8">Saiba como proceder com o uso do cart√£o em cen√°rios n√£o usuais, como o afastamento do gerente, para garantir a conformidade.</p>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm text-slate-700">
                    <thead class="text-xs text-slate-900 uppercase bg-slate-100">
                        <tr>
                            <th scope="col" class="py-3 px-6 rounded-tl-lg">Situa√ß√£o</th>
                            <th scope="col" class="py-3 px-6">Pode usar cart√£o de outra loja?</th>
                            <th scope="col" class="py-3 px-6">Justificar uso no campo ‚ÄúDescri√ß√£o‚Äù?</th>
                            <th scope="col" class="py-3 px-6 rounded-tr-lg">Respons√°vel pela presta√ß√£o de contas</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="bg-white border-b border-slate-100 hover:bg-slate-50">
                            <td class="py-3 px-6 font-semibold">Gerente em f√©rias ou afastamento tempor√°rio</td>
                            <td class="py-3 px-6">N√£o. Usa-se o cart√£o da pr√≥pria loja.</td>
                            <td class="py-3 px-6">N√£o, apenas informar tipo de gasto</td>
                            <td class="py-3 px-6">L√≠der ou Supervisor da loja</td>
                        </tr>
                        <tr class="bg-white border-b border-slate-100 hover:bg-slate-50">
                            <td class="py-3 px-6 font-semibold">Gerente desligado, sem novo gerente nomeado</td>
                            <td class="py-3 px-6">Sim, mediante autoriza√ß√£o financeira.</td>
                            <td class="py-3 px-6">Sim. Indicar loja beneficiada</td>
                            <td class="py-3 px-6">Gerente tempor√°rio</td>
                        </tr>
                        <tr class="bg-white hover:bg-slate-50">
                            <td class="py-3 px-6 font-semibold rounded-bl-lg">Falha t√©cnica no cart√£o</td>
                            <td class="py-3 px-6">N√£o. Usar sangria s√≥ com autoriza√ß√£o.</td>
                            <td class="py-3 px-6">N√£o se aplica</td>
                            <td class="py-3 px-6 rounded-br-lg">A definir com o financeiro, conforme o caso</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <section id="support" class="mb-20 bg-white rounded-xl shadow-lg p-6 text-center">
            <h2 class="text-3xl font-bold text-center mb-4 text-sky-900">Suporte e Canais de Ajuda</h2>
            <p class="text-lg text-center text-slate-600 max-w-3xl mx-auto mb-8">Precisa de ajuda com a plataforma Clara, tem d√∫vidas sobre funcionalidades ou encontrou algum problema?</p>
            <p class="mb-4 text-slate-700">Acesse a central de ajuda completa da Clara para encontrar respostas e solu√ß√µes:</p>
            <a href="https://ajuda.clara.com/hc/pt-br/categories/4413203275155-Funcionalidades-da-Plataforma-Clara" target="_blank" class="inline-block bg-sky-600 text-white font-semibold py-3 px-6 rounded-lg hover:bg-sky-700 transition duration-300 shadow-md">
                https://l1nq.com/47TUr
            </a>
            <p class="text-sm text-slate-500 mt-4">Este link redireciona para a Central de Ajuda da Clara.</p>
        </section>

        <section id="document-search" class="mb-20 bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-3xl font-bold text-center mb-4 text-sky-900">Pesquisa no Documento da Pol√≠tica</h2>
            <p class="text-lg text-center text-slate-600 max-w-3xl mx-auto mb-8">Pesquise por qualquer termo diretamente no conte√∫do completo da Pol√≠tica de Uso dos Cart√µes Clara.</p>
            <div class="max-w-4xl mx-auto">
                <div id="documentSearchArea">
                    <input type="text" id="documentSearchInput" class="w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 mb-4" placeholder="Digite seu termo de busca (ex: 'fraude', 'prazo')... ">
                    <button id="documentSearchBtn" class="w-full bg-sky-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-sky-700 transition duration-300 ease-in-out shadow-md">
                        Buscar no Documento
                    </button>
                    <div id="documentSearchResults" class="mt-6 space-y-4">
                        <p id="searchStatus" class="text-center text-slate-500">Documento da pol√≠tica carregado e pronto para busca.</p>
                        <div id="searchLoadingIndicator" class="mt-2 text-center text-sky-600 hidden">
                            <span class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-sky-600"></span>
                            <span class="ml-2">Buscando no documento...</span>
                        </div>
                    </div>
                </div>

                <div id="fullPolicyContentDisplay" class="hidden mt-8 p-4 border border-slate-200 rounded-lg shadow-lg">
                    <button id="backToSearchBtn" class="absolute top-4 right-4 bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-2 px-4 rounded-lg text-sm">
                        Voltar √† Pesquisa
                    </button>
                    <h3 class="text-xl font-bold text-sky-900 mb-4">Trecho da Pol√≠tica</h3>
                    <div id="policyTextRendered" class="text-sm text-black max-h-96 overflow-y-auto pr-2">
                        <!-- Policy content will be rendered here with highlights -->
                    </div>
                </div>
            </div>
        </section>

        <section id="reference" class="mb-16">
            <h2 class="text-3xl font-bold text-center mb-4 text-sky-900">Consulta R√°pida de Despesas</h2>
            <p class="text-lg text-center text-slate-600 max-w-3xl mx-auto mb-8">N√£o tem certeza se um gasto √© permitido? Pesquise aqui na lista oficial de categorias autorizadas.</p>
            <div class="max-w-4xl mx-auto bg-white p-6 rounded-xl shadow-lg">
                <input type="text" id="searchInput" class="w-full p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 mb-6" placeholder="Pesquisar por tipo de gasto (ex: limpeza, frete, marketing)...">
                <div id="expenseTable" class="space-y-3">
                    <!-- Conte√∫do ser√° carregado dinamicamente via JavaScript ap√≥s a pesquisa -->
                    <p class="text-center text-slate-500">Digite para pesquisar categorias de despesas.</p>
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-white mt-16 py-8 border-t border-slate-200">
        <div class="container mx-auto text-center text-slate-500">
            <p>&copy; 2025 Grupo SBF. Todos os direitos reservados.</p>
            <p class="text-xs mt-2">Este guia √© um resumo visual da Pol√≠tica de Uso dos Cart√µes Clara e n√£o substitui a leitura do documento completo.</p>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', function () {
    
    const wrapLabel = (label) => {
        const maxLength = 16;
        if (typeof label !== 'string' || label.length <= maxLength) return label;
        const words = label.split(' ');
        const lines = [];
        let currentLine = '';
        words.forEach(word => {
            if ((currentLine + word).length > maxLength) {
                lines.push(currentLine.trim());
                currentLine = word + ' ';
            } else {
                currentLine += word + ' ';
            }
        });
        lines.push(currentLine.trim());
        return lines.filter(line => line.length > 0);
    };

    const tooltipTitleCallback = (tooltipItems) => {
        const item = tooltipItems[0];
        if (!item) return '';
        let label = item.chart.data.labels[item.dataIndex];
        return Array.isArray(label) ? label.join(' ') : label;
    };
    
    const sharedChartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                position: 'bottom',
                labels: {
                    font: { family: 'Inter', size: 12 },
                    boxWidth: 15,
                    padding: 20,
                    color: '#475569'
                }
            },
            tooltip: {
                callbacks: { title: tooltipTitleCallback },
                titleFont: { family: 'Inter', weight: 'bold' },
                bodyFont: { family: 'Inter' },
                backgroundColor: '#0f172a',
                padding: 12,
                cornerRadius: 4
            }
        },
    };

    const blockingCriteriaCtx = document.getElementById('blockingCriteriaChart');
    if (blockingCriteriaCtx) {
        new Chart(blockingCriteriaCtx, {
            type: 'bar',
            data: {
                labels: ['Acima de R$ 1.000', 'R$ 500 a R$ 1.000', 'Abaixo de R$ 500'].map(wrapLabel),
                datasets: [{
                    label: 'Prazo M√°ximo para Regularizar (horas)',
                    data: [24, 48, 72],
                    backgroundColor: ['#ef4444', '#f97316', '#0ea5e9'],
                    borderRadius: 4
                }]
            },
            options: {
                ...sharedChartOptions,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Prazo para Regulariza√ß√£o (horas)', font: { family: 'Inter', size: 12 }, color: '#475569' },
                        ticks: { color: '#64748b' }
                    },
                    x: { ticks: { color: '#64748b' } }
                },
                plugins: { ...sharedChartOptions.plugins, legend: { display: false } }
            }
        });
    }

    // commonExpenseCategories updated as requested
    const expenseTableMainBody = document.getElementById('expenseTableMain');
    if (expenseTableMainBody) {
        const commonExpenseCategories = [
            { label: 'Marketing e Publicidade', examples: 'A√ß√µes promocionais, brindes, m√≠dia local, banners.' },
            { label: 'Servi√ßos Gr√°ficos e de Copiadoras', examples: 'Impress√£o de banners, adesivos promocionais, folders, encaderna√ß√µes.' },
            { label: '√Ågua Pot√°vel', examples: 'Compra de gal√µes de √°gua mineral, garrafas para abastecimento da equipe ou clientes.' },
            { label: 'Material de Inform√°tica', examples: 'Mouse, teclado, cabos, pendrive.' },
            { label: 'Lanches de Refei√ß√µes', examples: 'Coffee break para a√ß√µes internas, lanches para treinamentos.' }
        ];

        let tableRows = '';
        commonExpenseCategories.forEach((item, index) => {
            const isLastRow = index === commonExpenseCategories.length - 1;
            tableRows += `
                <tr class="bg-white ${isLastRow ? '' : 'border-b border-slate-100'} hover:bg-slate-50">
                    <td class="py-3 px-6 font-semibold ${isLastRow ? 'rounded-bl-lg' : ''}">${item.label}</td>
                    <td class="py-3 px-6 ${isLastRow ? 'rounded-br-lg' : ''}">${item.examples}</td>
                </tr>
            `;
        });
        expenseTableMainBody.innerHTML = tableRows;
    }

    const expenseTable = document.getElementById('expenseTable');
    const searchInput = document.getElementById('searchInput');

    // fullExpenseData now contains all topics from Anexo I for the search functionality
    const fullExpenseData = [
        { sap: '5102505001', label: 'MARKETING_PUBLICIDADE E PROPAGANDA', examples: 'A√ß√µes promocionais, compra de brindes para campanha, contrata√ß√£o de m√≠dia local, impulsionamento de redes sociais, banners promocionais.' },
        { sap: '5103505001', label: 'MATERIAL DE LIMPEZA', examples: 'Detergente, sab√£o, desinfetante, papel toalha, pano de ch√£o, esponja, rodo, vassoura, √°lcool, produtos de higiene ambiental.' },
        { sap: '5103505005', label: 'MATERIAL DE INFORM√ÅTICA', examples: 'Mouse, teclado, cabos, pendrive, suportes de notebook, fontes, roteadores, hubs USB, cart√µes de mem√≥ria (sem controle patrimonial).' },
        { sap: '5103505006', label: 'MATERIAL DE ESCRIT√ìRIO', examples: 'Canetas, clips, cadernos, pastas, blocos de anota√ß√£o, grampeadores, etiquetas, organizadores de mesa.' },
        { sap: '5103505007', label: 'MATERIAL DE COPA E COZINHA', examples: 'Pratos, copos, talheres, filtros de caf√©, garrafas t√©rmicas, panos de prato, esponjas, potes pl√°sticos (sem el√©tricos).' },
        { sap: '5103510001', label: 'MANUTEN√á√ÉO CIVIL', examples: 'Pequenos reparos em paredes, troca de revestimentos, consertos em portas ou fechaduras (exceto chaveiro), troca de vidros, ajustes em prateleiras fixas.' },
        { sap: '5103510005', label: 'MANUTEN√á√ÉO ELETRICO', examples: 'Troca de tomadas, disjuntores, interruptores, reatores, soquetes, extens√µes el√©tricas, pequenos reparos de fia√ß√£o de baixa tens√£o.' },
        { sap: '5103510007', label: 'MANUTEN√á√ÉO EQUIPAMENTOS', examples: 'Reparos em impressoras de etiqueta, m√°quinas de estampar, computadores (desde que fora de garantia e com baixo valor), ferramentas manuais.' },
        { sap: '5103510010', label: 'MANUTEN√á√ÉO AR-CONDICIONADO', examples: 'Manuten√ß√£o corretiva/preventiva simples de ar-condicionado (limpeza de filtro, carga de g√°s, troca de controle remoto ou pe√ßas simples).' },
        { sap: '5104007003', label: 'TRANSPORTE SERVI√áOS EMERGENCIAS', examples: 'Frete local emergencial, motoboy para transporte de documentos ou itens urgentes entre lojas ou matriz, entrega de materiais cr√≠ticos.' },
        { sap: '5104505006', label: 'SERVI√áOS GR√ÅFICOS E DE COPIADORAS', examples: 'Impress√£o de banners, adesivos promocionais, folders, encaderna√ß√µes, produ√ß√£o de manuais impressos.' },
        { sap: '5104610002', label: 'CORREIOS_SEDEX/AR/POSTAGEM', examples: 'Envio de documentos f√≠sicos via Sedex, AR, carta registrada, pacotes pequenos, devolu√ß√µes via Correios.' },
        { sap: '5105505008', label: 'LANCHES DE REFEI√á√ïES', examples: 'Compra de coffee break para a√ß√µes internas, lanches para treinamentos, premia√ß√µes, eventos internos autorizados.' },
        { sap: '5103505007', label: 'AGUA POT√ÅVEL', examples: 'Compra de gal√µes de √°gua mineral, garrafas para abastecimento da equipe ou clientes em loja (se previsto nas diretrizes operacionais).' },
        { sap: '5103505006', label: 'BOBINA ECF', examples: 'Compra de bobinas para ECF ou impressoras fiscais (uso obrigat√≥rio nas lojas que n√£o t√™m fornecimento centralizado).' },
        { sap: '5103510007', label: 'CHAVEIRO EMERGENCIAL', examples: 'Servi√ßos de abertura ou troca de fechadura de cofres, salas administrativas, estoques, vitrines ‚Äì exclusivamente em situa√ß√µes emergenciais.' },
        { sap: '5103510007', label: 'MANUTEN√á√ÉO MAQ ESTAMPAR', examples: 'Reparos simples ou ajustes t√©cnicos em m√°quinas de estampar produtos promocionais nas lojas ‚Äì sem controle patrimonial e com nota fiscal do prestador.' }
        /* Removed: { sap: '5104505007', label: 'SERVI√áOS DE LIMPEZA', examples: 'Contrata√ß√£o pontual de diaristas, faxineiras para limpeza extra, empresas terceirizadas em servi√ßos avulsos de limpeza ou desinfec√ß√£o emergencial.' } */
    ];

    const renderTable = (data) => {
        expenseTable.innerHTML = '';
        if (data.length === 0) {
            expenseTable.innerHTML = `<p class="text-center text-slate-500">Nenhuma categoria encontrada.</p>`;
            return;
        }
        data.forEach(item => {
            const row = `
                <div class="p-4 border border-slate-200 rounded-lg bg-slate-50/50">
                    <p class="font-bold text-sky-800">${item.label}</p>
                    <p class="text-sm text-slate-600">${item.examples}</p>
                </div>
            `;
            expenseTable.innerHTML += row;
        });
    };
    
    searchInput.addEventListener('input', (e) => {
        const searchTerm = e.target.value.trim().toLowerCase(); // Use trim() for empty check
        if (searchTerm === '') {
            expenseTable.innerHTML = `<p class="text-center text-slate-500">Digite para pesquisar categorias de despesas.</p>`;
            return;
        }

        const filteredData = fullExpenseData.filter(item => 
            item.label.toLowerCase().includes(searchTerm) || 
            item.examples.toLowerCase().includes(searchTerm)
        );
        renderTable(filteredData);
    });

    const navButtons = document.querySelectorAll('.nav-button');
    const sections = document.querySelectorAll('main section');

    navButtons.forEach(button => {
        button.addEventListener('click', () => {
            const targetId = button.getAttribute('data-target');
            const targetSection = document.getElementById(targetId);
            if (targetSection) {
                targetSection.scrollIntoView({ behavior: 'smooth' });
            }
        });
    });

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                navButtons.forEach(button => {
                    button.classList.toggle('active', button.getAttribute('data-target') === entry.target.id);
                });
            }
        });
    }, { rootMargin: '-20% 0px -80% 0px', threshold: 0 });

    sections.forEach(section => {
        observer.observe(section);
    });

    // Document Search Functionality
    const documentSearchInput = document.getElementById('documentSearchInput');
    const documentSearchBtn = document.getElementById('documentSearchBtn');
    const documentSearchResults = document.getElementById('documentSearchResults');
    const searchStatus = document.getElementById('searchStatus');
    const searchLoadingIndicator = document.getElementById('searchLoadingIndicator');
    const documentSearchArea = document.getElementById('documentSearchArea'); // Area containing input, button, results
    const fullPolicyContentDisplay = document.getElementById('fullPolicyContentDisplay');
    const policyTextRendered = document.getElementById('policyTextRendered');
    const backToSearchBtn = document.getElementById('backToSearchBtn');

    // Content of POLITICA DE UTILIZA√á√ÉO_CART√ïES CLARA.docx embedded directly
    let policyDocumentContent = `Pol√≠tica de Uso dos Cart√µes Clara nas Lojas
POL√çTICA INTERNA
[CONTAS A RECEBER]
√öLTIMA ATUALIZA√á√ÉO: 24/06/2025
SUM√ÅRIO
 1. 	 Objetivo	3
2. 	 Abrang√™ncia	4
3. 	 Melhorias	4
4. 	 Defini√ß√µes Importantes	6
5. 	 Limite dos Cart√µes	9
6. 	 Presta√ß√£o de Contas	10
7. 	 Restri√ß√µes de Uso	19
8. 	 Responsabilidades	26
9. 	 Monitoramento, Auditoria e Fraudes	32
10. 	 Revis√£o	35
Anexo I ‚Äì Quadro de Etiquetas por Tipo de Gasto 	35

Objetivo
Estabelecer os  conceitos, responsabilidades, crit√©rios operacionais e limites  aplic√°veis √† utiliza√ß√£o dos cart√µes da Clara para despesas operacionais, fornecidos aos gerentes das lojas do Grupo SBF, incluindo as unidades Centauro e Fisia.
Esta pol√≠tica tem como objetivo principal o  uso adequado, transparente e controlado  dos   cart√µes no contexto das atividades operacionais das lojas, abrangendo desde a autoriza√ß√£o de despesas at√© a presta√ß√£o de contas obrigat√≥ria.
As diretrizes aqui descritas visam assegurar a  ader√™ncia √†s normas internas da companhia,  √†  legisla√ß√£o vigente  e √†s boas pr√°ticas de governan√ßa corporativa, reduzindo riscos financeiros e operacionais.
A gest√£o dos cart√µes √© realizada por meio da  plataforma digital da CLARA INSTITUI√á√ÉO DE PAGAMENTO LTDA ., que centraliza os registros de transa√ß√µes, limites, comprovantes fiscais e relat√≥rios para concilia√ß√£o e pagamentos.
O documento ainda define o papel e as obriga√ß√µes dos portadores dos cart√µes, da lideran√ßa imediata, do departamento financeiro e demais envolvidos, bem como estabelece as medidas corretivas e preventivas aplic√°veis em caso de uso indevido ou descumprimento das regras.
Abrang√™ncia
Esta pol√≠tica aplica-se a todas as lojas do Grupo SBF, Centauro e Fisia, e √© de aplica√ß√£o obrigat√≥ria, uma vez que obtenham e utilizem os cart√µes fornecidos pela empresa. A abrang√™ncia desta pol√≠tica se estende aos colaboradores, funcion√°rios e representantes das lojas do Grupo SBF que forem designados como portadores dos cart√µes para uso no desempenho de suas fun√ß√µes profissionais, enquanto empregados do Grupo SBF, e abarca todas as transa√ß√µes comerciais realizadas com os cart√µes, afirmando assim uma cobertura abrangente e uniforme em todas as lojas que utilizem esse meio de pagamento. Vale ressaltar que esta pol√≠tica n√£o substitui a  Pol√≠tica de Compras , de forma que as despesas de sangria acontecem em um car√°ter de exce√ß√£o e emergencial, respeitando a mesma.
Melhorias
O processo de implementa√ß√£o de cart√µes da Clara visa otimizar e simplificar as opera√ß√µes financeiras das lojas do Grupo SBF, oferecendo maior autonomia e praticidade no dia a dia. Em substitui√ß√£o ao procedimento anterior de sangria de caixa, o uso desses cart√µes traz diversos benef√≠cios significativos. Em suma, a implementa√ß√£o desse procedimento representa um avan√ßo significativo na gest√£o financeira das lojas, proporcionando maior seguran√ßa, agilidade, controle e efici√™ncia nas opera√ß√µes di√°rias, sendo eles:
 Redu√ß√£o de Riscos e Seguran√ßa Financeira : Os cart√µes eliminam a necessidade de manipula√ß√£o de quantias em dinheiro, reduzindo os riscos associados a roubos, fraudes e erros de contagem de caixa. Isso garante maior seguran√ßa financeira para as lojas e seus colaboradores, trazendo tamb√©m maior efic√°cia na quest√£o da concilia√ß√£o financeira.
Facilidade de Controle e Gest√£o Financeira : Os cart√µes permitem um maior controle e gest√£o das despesas, pois todas as transa√ß√µes s√£o registradas eletronicamente e podem ser facilmente acompanhadas e monitoradas por meio de relat√≥rios detalhados na plataforma da Clara. Isso facilita a identifica√ß√£o de gastos desnecess√°rios e o acompanhamento do or√ßamento dispon√≠vel para cada loja. 
Flexibilidade e Adaptabilidade √†s Necessidades : Os cart√µes oferecem maior flexibilidade e adaptabilidade √†s necessidades das lojas do Grupo SBF.
Melhoria no Fluxo de Caixa e Antecipa√ß√£o de Numer√°rio:  Com o fim das sangrias de despesas, o valor arrecadado nas vendas permanece integralmente no caixa da loja at√© o envio direto ao banco, sem necessidade de retiradas frequentes para gastos operacionais. Isso contribui para um  menor prazo de recebimento do numer√°rio pela empresa , melhora o controle sobre o caixa f√≠sico e otimiza a gest√£o do fluxo de recursos em cada loja. Antes da implanta√ß√£o do cart√£o, parte do dinheiro do caixa da loja era retirada antecipadamente (via sangria) para pagar despesas operacionais. Ou seja, esse valor sa√≠a do caixa antes de ser contabilizado e enviado √† tesouraria central. Com o cart√£o:
As despesas operacionais  n√£o s√£o mais pagas com dinheiro do caixa ;
Todo o valor das vendas  fica retido no caixa at√© o envio completo do numer√°rio  ao banco;
Isso faz com que o numer√°rio seja  recebido mais cedo e em sua totalidade  pela empresa, pois  n√£o h√° retirada antecipada para cobrir despesas .
Aumenta o volume enviado ao banco (sem perdas ou antecipa√ß√µes);
Reduz o tempo entre a venda e o recebimento centralizado do valor.
As categorias de compras que est√£o liberadas para o uso, podendo sofrer altera√ß√µes pela √°rea financeira caso seja necess√°rio, s√£o: Alimenta√ß√£o; Bares ou bebidas (n√£o alco√≥licas); Comunica√ß√£o; Com√©rcio digital; Constru√ß√£o e servi√ßos; Lojas de varejo; Lojas especializadas; Materiais de escrit√≥rio; Produtos t√™xteis; Publicidade digital; Servi√ßos especiais; Servi√ßos profissionais; Software e hardware.
Defini√ß√µes Importantes Para fins desta pol√≠tica, adotam-se as seguintes defini√ß√µes essenciais:
4.1. Comprovante Fiscal:  Documento emitido pelo estabelecimento comercial (nota fiscal ou cupom fiscal) que formaliza legalmente a transa√ß√£o realizada, sendo obrigat√≥rio para presta√ß√£o de contas.
4.2. Comprovante de Pagamento:  Documento ou evid√™ncia que comprove a realiza√ß√£o da transa√ß√£o financeira, podendo ser: recibo, print da confirma√ß√£o de pagamento, e-mail de confirma√ß√£o ou outro registro equivalente.
4.3. Etiqueta:  Categoria padronizada que identifica o tipo de gasto realizado, sendo obrigat√≥ria sua correta associa√ß√£o a cada transa√ß√£o na plataforma Clara, para fins de concilia√ß√£o cont√°bil e an√°lise financeira.
4.4. Bloqueio Preventivo:  Suspens√£o tempor√°ria da utiliza√ß√£o do cart√£o, aplicada em situa√ß√µes de descumprimento das obriga√ß√µes de presta√ß√£o de contas, com o objetivo de mitigar riscos financeiros e assegurar a conformidade com esta pol√≠tica.
4.5. Transa√ß√£o:  Opera√ß√£o financeira realizada com o cart√£o para pagamento de despesas autorizadas, registrada eletronicamente na plataforma Clara.
4.6. Presta√ß√£o de Contas:  Procedimento obrigat√≥rio de registro e justificativa de cada transa√ß√£o realizada com o cart√£o, mediante inser√ß√£o de etiqueta, comprovante fiscal e descri√ß√£o, conforme prazos estabelecidos nesta pol√≠tica.
4.7. Respons√°vel pela Presta√ß√£o de Contas:  Portador do cart√£o ou, em caso de afastamento, o l√≠der ou supervisor designado formalmente, incumbido de realizar o correto registro e justificativa das transa√ß√µes.
4.8. Departamento Financeiro:  √Årea da empresa respons√°vel pela gest√£o, acompanhamento e auditoria das transa√ß√µes realizadas com os cart√µes, bem como pela aplica√ß√£o de medidas corretivas previstas nesta pol√≠tica.
4.9. Reincid√™ncia:  Nova ocorr√™ncia de descumprimento das obriga√ß√µes de presta√ß√£o de contas ou das restri√ß√µes de uso ap√≥s orienta√ß√£o formal ou aplica√ß√£o de medida corretiva anterior.
4.10. Contesta√ß√£o:  Processo formal de questionamento ou disputa de uma transa√ß√£o considerada irregular ou indevida, realizado junto ao suporte da Clara em conformidade com os prazos e procedimentos previstos nesta pol√≠tica.
4.11. Revis√£o das Categorias Liberadas:  A √°rea financeira revisar√° periodicamente as categorias liberadas, podendo fazer ajustes de acordo com as necessidades operacionais, estrat√©gia de controle e eventuais ocorr√™ncias de uso indevido.
4.12. Portador Tempor√°rio:  Colaborador que assume o uso do cart√£o em car√°ter provis√≥rio, durante o afastamento do portador titular, mediante valida√ß√£o formal do departamento financeiro. Suas responsabilidades s√£o as mesmas do portador original, incluindo a presta√ß√£o de contas e guarda segura do cart√£o.
4.13. Sangrias de Caixa:  Procedimento de retirada de numer√°rio do caixa da loja para pagamento de despesas operacionais, agora descontinuado nas unidades que utilizam o cart√£o, conforme item 3 ‚Äì Benef√≠cios.
4.14. Treinamento Obrigat√≥rio:  Encontro ou conte√∫do disponibilizado pelo financeiro que aborda o uso correto do cart√£o e da plataforma Clara, sendo condi√ß√£o obrigat√≥ria para libera√ß√£o e ativa√ß√£o do cart√£o ao portador designado.
4.15. Service Now:  Sistema interno para abertura de chamados.
Limite dos Cart√µes
Os cart√µes t√™m limites predefinidos para despesas mensais, de acordo com a hierarquia e as necessidades operacionais de cada loja, e conforme estabelecido pela pol√≠tica interna da empresa e em conformidade com a legisla√ß√£o aplic√°vel relacionada √† gest√£o financeira corporativa, podendo sofrer altera√ß√£o para limite di√°rio caso se julgue necess√°rio.
Cada gerente regional (respons√°vel por seu grupo de lojas) ter√° acesso √†s transa√ß√µes e limites de despesas das lojas que gerencia/administra, trazendo assim um controle mais eficaz sobre os gastos. Cada gerente de loja arcar√° e prestar√° contas a respeito dos custos da loja que gerencia. 
O cart√£o pode ser utilizado  todos os dias da semana , inclusive aos finais de semana e feriados, sem restri√ß√£o de data, desde que respeitadas as diretrizes de uso desta pol√≠tica.
Importante destacar que o  limite dispon√≠vel √© mensal e n√£o di√°rio , ou seja, o valor total liberado deve ser utilizado de forma planejada ao longo do m√™s, para cobrir as despesas operacionais recorrentes da loja. O mesmo ser√° reposto assim que houver o pagamento da fatura no per√≠odo corrente, por√©m, pode sofrer altera√ß√£o para limite di√°rio caso se julgue necess√°rio.
Os limites de despesas ser√£o revisados regularmente e poder√£o ser ajustados conforme necess√°rio, levando em considera√ß√£o as condi√ß√µes econ√¥micas, disponibiliza√ß√£o de limite contratual junto √† Clara e as metas financeiras da empresa. 
Todas as solicita√ß√µes de aumento de limite devem ser efetuadas via abertura de chamado no  Service Now , detalhando a justificativa e a urg√™ncia da transa√ß√£o.
Fica estabelecido que os cart√µes s√£o destinados exclusivamente para despesas operacionais e n√£o devem ser utilizados para gastos que excedam os limites estabelecidos, salvo em casos de emerg√™ncia devidamente documentados e autorizados. 
A utiliza√ß√£o de valores acima do limite sem autoriza√ß√£o pr√©via poder√° ser considerada uso indevido, conforme item 7 ‚Äì Restri√ß√µes de Uso.
Os portadores dos cart√µes devem sempre buscar alternativas econ√¥micas e eficientes para as compras, tendo uma otimiza√ß√£o dos recursos da empresa.
Refor√ßando, em caso de necessidade de despesas excepcionais que ultrapassem os limites predefinidos dos cart√µes, os portadores devem obter autoriza√ß√£o pr√©via do departamento financeiro de contas a receber atrav√©s de abertura de chamado via  Service Now .
Presta√ß√£o de Contas
Para toda e qualquer transa√ß√£o efetuada com os cart√µes, deve ser feita a devida justificativa na plataforma da Clara pelo usu√°rio:
Inserir etiqueta correspondente ao gasto (Conforme Anexo I)
Anexar o comprovante fiscal;
Preencher o campo ‚ÄúDescri√ß√£o‚Äù com o detalhamento do gasto.
Para cada tipo de gasto h√° uma conta cont√°bil para o envio da informa√ß√£o e contabiliza√ß√£o, o financeiro efetua esse processo atrav√©s da extra√ß√£o de relat√≥rios na plataforma da Clara, por esse motivo √© extremamente importante termos a etiqueta atrelada ao gasto. Diariamente h√° o acompanhamento de todas as transa√ß√µes na plataforma, para ter total controle dos gastos e verificar se os mesmos est√£o corretamente lan√ßados, com isso, analisamos:
Se h√° nota fiscal/recibo anexado;
Se o comprovante fiscal anexado condiz com o valor da compra;
Se a etiqueta est√° devidamente atrelada;
Se o custo da compra √© condizente.
O prazo padr√£o para justificar a compra na plataforma da Clara (caso n√£o tenham feito no momento da compra) ap√≥s a mesma ter sido efetuada, atrav√©s da inser√ß√£o da etiqueta e comprovante fiscal, √© de 48 horas. Caso seja identificado pela √°rea financeira que alguma transa√ß√£o est√° sem as devidas justificativas, enviaremos um e-mail de cobran√ßa para o titular do cart√£o (gerente da loja) solicitando que as corre√ß√µes sejam efetuadas, se n√£o tivermos resposta no tempo definido, poderemos, sem aviso pr√©vio, seguir com o bloqueio do cart√£o at√© que as pendencias sejam sanadas, conforme explana√ß√£o no item  6.1 .
Caso uma categoria de gasto n√£o seja encontrada na listagem inicial de etiquetas da plataforma da Clara, a solicita√ß√£o para cria√ß√£o e inser√ß√£o de uma nova etiqueta deve ser encaminhada atrav√©s de abertura de chamado no  Service Now .
Mesmo ap√≥s a inser√ß√£o dos comprovantes na plataforma da Clara, os documentos f√≠sicos (notas fiscais, recibos) dever√£o ser mantidos em arquivo na loja por, no m√≠nimo, 90 dias corridos, podendo ser solicitados para auditoria pela √°rea financeira.
 Crit√©rios de Bloqueio do Cart√£o
Transa√ß√µes de valor elevado:  Para transa√ß√µes acima de R$ 1.000,00 sem o devido comprovante fiscal anexado na plataforma no prazo de 24 horas, ser√° efetuado o bloqueio preventivo do cart√£o da loja, enviaremos a cobran√ßa formal por e-mail j√° informando sobre isso, e o desbloqueio ser√° feito assim que a situa√ß√£o for regularizada.
Transa√ß√µes de valor m√©dio:  Para transa√ß√µes entre R$ 500,00 e R$ 1.000,00 sem o comprovante fiscal anexado no prazo de 48 horas da data da compra, ser√° emitido um alerta formal ao gerente da loja, seguindo o fluxo de cobran√ßa por e-mail, com prazo de 48 horas para regulariza√ß√£o.   Caso n√£o haja regulariza√ß√£o neste prazo, o cart√£o ser√° previamente bloqueado e ser√° enviada uma nova cobran√ßa por e-mail, o desbloqueio ocorrer√° ap√≥s a regulariza√ß√£o da situa√ß√£o.
Transa√ß√µes de pequeno valor:  Para transa√ß√µes abaixo de R$ 500,00, a aus√™ncia de comprovante fiscal ser√° tratada inicialmente com o envio da cobran√ßa por e-mail no prazo de 48 horas da data da compra. Caso n√£o haja regulariza√ß√£o neste prazo, ser√° enviada uma nova cobran√ßa por e-mail. N√£o tendo o retorno dentro de 24 horas, ser√° efetuado o bloqueio preventivo do cart√£o at√© que a situa√ß√£o seja regularizada, o desbloqueio ser√° feito assim que a situa√ß√£o for regularizada.
A reincid√™ncia nos descumprimentos pode impactar diretamente a elegibilidade da loja para uso do cart√£o, conforme tamb√©m previsto no item 8 ‚Äì Responsabilidades.
QUADRO DE PRAZOS PARA PRESTA√á√ÉO DE CONTAS

Tipo de Transa√ß√£o,Valor da Transa√ß√£o,Prazo para Regulariza√ß√£o,Medida Corretiva
Transa√ß√£o comum,"At√© R$ 500,00",48h + 24h ap√≥s cobran√ßa,Bloqueio preventivo se n√£o regularizado
Transa√ß√£o m√©dia,"R$ 500,01 a R$ 1.000,00",48h ap√≥s cobran√ßa,Bloqueio preventivo se n√£o regularizado
Transa√ß√£o elevada,"Acima de R$ 1.000,00",24h ap√≥s transa√ß√£o,Bloqueio preventivo imediato
Marketplaces,Qualquer valor,48h para registro + 48h ap√≥s recebimento para anexar nota,Bloqueio preventivo se n√£o regularizado

Situa√ß√µes excepcionais e devidamente justificadas poder√£o ser analisadas caso a caso, mediante parecer do titular do cart√£o.
Em caso de reincid√™ncia frequente ou ind√≠cios de m√°-f√©, a empresa poder√° aplicar medidas disciplinares adicionais, conforme a pol√≠tica interna de conduta, ou at√© mesmo proceder √† revis√£o da elegibilidade da loja para utiliza√ß√£o do cart√£o.
Para casos em que o respons√°vel pelo cart√£o ou o departamento financeiro identificar que a compra √© pass√≠vel de contesta√ß√£o, deve-se acionar diretamente o suporte da Clara (contato@clara.com) em at√© 2 dias √∫teis ap√≥s a transa√ß√£o, para que eles possam seguir com a an√°lise da compra. Caso constatado a irregularidade, o valor ser√° estornado para a empresa. Esse procedimento poder√° ter o cart√£o previamente bloqueado at√© que a an√°lise seja finalizada pela operadora.
Nota de Esclarecimento : O processo de contesta√ß√£o aplica-se a transa√ß√µes n√£o reconhecidas ou irregulares feitas pela loja. Ele √© diferente do procedimento para despesas pessoais, em que o portador reconhece o gasto e realiza o ressarcimento √† empresa.
Compras Realizadas em Aplicativos de E-commerce
Em casos de compras realizadas em aplicativos ou Marketplaces em que a  nota fiscal n√£o √© emitida no momento da transa√ß√£o , o respons√°vel dever√°, no prazo padr√£o de at√©  48 horas :
Registrar a transa√ß√£o na plataforma com a  etiqueta correspondente;  
Anexar o  comprovante de pagamento  (recibo da compra, confirma√ß√£o do pedido ou print do aplicativo que comprove a efetiva√ß√£o da compra).
Informar no campo de justificativa que a  nota fiscal ser√° anexada posteriormente , assim que recebida.
Anexa√ß√£o posterior:
Assim que a nota fiscal for recebida (junto ao produto ou por e-mail), o respons√°vel dever√° anex√°-la √† plataforma no prazo m√°ximo de 48 horas ap√≥s o recebimento do produto. O n√£o cumprimento desse prazo implicar√° no bloqueio preventivo do cart√£o, conforme os crit√©rios gerais desta pol√≠tica.
Os prazos e regras aqui descritos seguem os mesmos crit√©rios de regulariza√ß√£o e bloqueio definidos no item 6 ‚Äì Presta√ß√£o de Contas.
Para manter a conformidade das transa√ß√µes com os crit√©rios operacionais da empresa, consulte tamb√©m o item 7 ‚Äì Restri√ß√µes de Uso, que detalha os tipos de despesas proibidas ou condicionadas √† autoriza√ß√£o pr√©via.
Substitui√ß√£o de uso do cart√£o
Conforme descrito no item 3 ‚Äì Benef√≠cios, a substitui√ß√£o da sangria pelo cart√£o visa padronizar os processos financeiros e assegura maior controle nas lojas.
Ap√≥s  a implanta√ß√£o do cart√£o em cada loja e a confirma√ß√£o formal de recebimento, acompanhada do treinamento de uso da plataforma da Clara, o processo de sangria de despesas √© descontinuado para as unidades Centauro. Isso ocorre por meio da trava simult√¢nea do PDV e do fluxo de solicita√ß√µes de sangrias na intranet, impedindo que a loja realize retiradas de dinheiro em esp√©cie para pagamento de despesas.
Esse bloqueio √© aplicado exclusivamente √†s lojas Centauro. Para as  lojas Fisia n√£o h√° necessidade de bloqueio no PDV ou na intranet,  pois esse modelo de opera√ß√£o n√£o utiliza sangrias de caixa para despesas operacionais.
Dessa forma, ap√≥s a implanta√ß√£o, o cart√£o passa a ser o √∫nico meio autorizado para realiza√ß√£o de despesas operacionais. O processo de sangria √© considerado encerrado e n√£o deve mais ser utilizado.
Em situa√ß√µes excepcionais , nas quais a loja n√£o consiga utilizar o cart√£o (por falha t√©cnica ou outro motivo justificado),  √© obrigat√≥rio que a equipe da loja comunique previamente o departamento financeiro,  entendendo-se ‚Äú previamente‚Äù  em casos que souber da necessidade do gasto operacional na loja.  A equipe analisar√° o caso e, se for realmente necess√°rio, poder√° liberar temporariamente o processo de sangria (via PDV e intranet, no caso de lojas Centauro), para que a despesa seja realizada como exce√ß√£o e devidamente justificada.
Essa libera√ß√£o, no entanto, ser√° autorizada somente ap√≥s uma an√°lise rigorosa, uma vez que, como refor√ßado durante o treinamento, n√£o √© permitida a retomada do processo de sangria como pr√°tica ap√≥s a ativa√ß√£o do cart√£o na loja.
Utiliza√ß√£o provis√≥ria de cart√£o de outra loja
Nos casos em que o gerente titular de uma loja estiver ausente (por desligamento) e ainda n√£o houver a emiss√£o de um novo cart√£o vinculado √† nova gest√£o da unidade, poder√° ser autorizada, temporariamente, a utiliza√ß√£o do cart√£o de outra loja, desde que  previamente acordado  com o departamento financeiro.
Nessa hip√≥tese, torna-se obrigat√≥rio que o gerente substituto registre no campo ‚Äú Descri√ß√£o ‚Äù da plataforma Clara (no app ou site), de forma clara e objetiva, que aquela despesa se refere a uma loja diferente daquela √† qual o cart√£o est√° originalmente vinculado. A descri√ß√£o deve conter expressamente a informa√ß√£o da loja beneficiada, utilizando o seguinte modelo ( Essa exig√™ncia refor√ßa os crit√©rios estabelecidos no item 6 ‚Äì Presta√ß√£o de Contas, especialmente quanto √† descri√ß√£o clara das despesas na plataforma Clara.): "Uso tempor√°rio do cart√£o na loja XXXX." Esse procedimento √© essencial para a correta aloca√ß√£o e identifica√ß√£o das despesas, permitindo que o financeiro realize a reclassifica√ß√£o adequada no momento da concilia√ß√£o cont√°bil e fechamento da fatura.`;

    // Replace all instances of "Cart√µes Corporativos" with "Cart√µes Clara"
    policyDocumentContent = policyDocumentContent.replace(/Cart√µes Corporativos/g, 'Cart√µes Clara');
    // Replace all instances of "cart√£o corporativo" with "cart√£o da Clara"
    policyDocumentContent = policyDocumentContent.replace(/cart√£o corporativo/g, 'cart√£o da Clara');
    // Replace standalone "corporativo" or "corporativos" that are not part of the previously replaced phrases.
    // This regex looks for ' corporativo' or ' corporativos' preceded by a word boundary and followed by a word boundary or a punctuation mark.
    policyDocumentContent = policyDocumentContent.concat(' ').replace(/\bcorporativo(s)?\b/g, '').trim(); // Add space to handle end-of-content matches


    // Helper to escape regex special characters
    function escapeRegExp(string) {
        return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    // Map of common section titles to their desired HTML IDs for anchoring
    // This needs to be comprehensive for all main sections of the policy that could be targets
    const sectionToIdMap = {
        'Pol√≠tica de Uso dos Cart√µes Clara nas Lojas': 'politica-uso', // Added for the main title
        'POL√çTICA INTERNA': 'politica-interna', // Added for main title
        '[CONTAS A RECEBER]': 'contas-a-receber',
        '√öLTIMA ATUALIZA√á√ÉO: 24/06/2025': 'ultima-atualizacao',
        'SUM√ÅRIO': 'sumario', // Added for main title
        '1. 	 Objetivo': 'objetivo',
        '2. 	 Abrang√™ncia': 'abrangencia',
        '3. 	 Melhorias': 'melhorias',
        '4. 	 Defini√ß√µes Importantes': 'definicoes-importantes',
        '5. 	 Limite dos Cart√µes': 'limite-cartoes',
        '6. 	 Presta√ß√£o de Contas': 'prestacao-contas',
        'Crit√©rios de Bloqueio do Cart√£o': 'criterios-bloqueio',
        'QUADRO DE PRAZOS PARA PRESTA√á√ÉO DE CONTAS': 'quadro-prazos',
        'Situa√ß√µes excepcionais e devidamente justificadas': 'situacoes-excepcionais-justificadas',
        'Compras Realizadas em Aplicativos de E-commerce': 'compras-e-commerce',
        'Substitui√ß√£o de uso do cart√£o': 'substituicao-cartao',
        'Utiliza√ß√£o provis√≥ria de cart√£o de outra loja': 'utilizacao-provisoria',
        '7. 	 Restri√ß√µes de Uso': 'restricoes-uso',
        '8. 	 Responsabilidades': 'responsabilidades',
        '9. 	 Monitoramento, Auditoria e Fraudes': 'monitoramento-auditoria-fraudes',
        '10. 	 Revis√£o': 'revisao',
        'Anexo I ‚Äì Quadro de Etiquetas por Tipo de Gasto': 'anexo-i'
    };

    const mainSectionHeadings = Object.keys(sectionToIdMap);
    let parsedPolicySections = {}; // Global variable to store parsed content with its start/end character indices

    // Function to parse the policy content into structured sections based on headings
    function parsePolicyIntoSections() {
        parsedPolicySections = {}; // Reset parsed sections for each call (important for updates)

        const detectedHeadings = []; // Store { title: "...", startIndex: <char_index>, originalLine: "..." }

        // Step 1: Detect all actual heading occurrences and their start indices
        for (const headingText of mainSectionHeadings) {
            // Create a regex to match the heading text, accounting for potential leading numbers/tabs
            const headingRegex = new RegExp(`^(\\s*\\d+\\.?\\s*|\\s*)${escapeRegExp(headingText)}(\\s*|$)`, 'gmi');
            let match;
            while ((match = headingRegex.exec(policyDocumentContent)) !== null) {
                detectedHeadings.push({
                    title: headingText, // Canonical title
                    startIndex: match.index,
                    originalLine: match[0].trim() // The exact matched line including numbers/tabs
                });
            }
        }

        // Sort detected headings by their appearance in the document
        detectedHeadings.sort((a, b) => a.startIndex - b.startIndex);

        // Step 2: Populate parsedPolicySections with content based on detected headings
        // Handle content before the first detected heading (preamble)
        if (detectedHeadings.length > 0 && detectedHeadings[0].startIndex > 0) {
            const preambleContent = policyDocumentContent.substring(0, detectedHeadings[0].startIndex).trim();
            if (preambleContent) {
                parsedPolicySections['Introdu√ß√£o ao Documento'] = {
                    rawContent: preambleContent,
                    startCharIndex: 0,
                    endCharIndex: preambleContent.length
                };
            }
        } else if (detectedHeadings.length === 0 && policyDocumentContent.trim().length > 0) {
            // If no headings found, treat entire document as one "Introduction"
            parsedPolicySections['Introdu√ß√£o ao Documento'] = {
                rawContent: policyDocumentContent.trim(),
                startCharIndex: 0,
                endCharIndex: policyDocumentContent.trim().length
            };
            return;
        }

        // Iterate through detected headings to extract section content
        for (let i = 0; i < detectedHeadings.length; i++) {
            const currentHeading = detectedHeadings[i];
            const nextHeading = detectedHeadings[i + 1];
            
            const sectionEndIndex = nextHeading ? nextHeading.startIndex : policyDocumentContent.length;
            
            // Extract content from current heading's start to the next heading's start (or end of document)
            const rawContent = policyDocumentContent.substring(currentHeading.startIndex, sectionEndIndex);
            
            if (rawContent.trim()) { // Ensure there's actual content
                parsedPolicySections[currentHeading.title] = {
                    rawContent: rawContent,
                    startCharIndex: currentHeading.startIndex,
                    endCharIndex: sectionEndIndex
                };
            }
        }
        // console.log("Parsed Sections:", parsedPolicySections); // Debugging
    }

    // Function to process policy text and apply formatting (bold titles/subtitles, black text)
    function formatPolicyText(text, queryToHighlight = '') {
        let processedText = text;
        processedText = processedText.replace(/\r/g, '').replace(/ {2,}/g, ' ');

        const lines = processedText.split('\n');
        let htmlContent = [];
        let currentParagraphLines = [];

        // Regex for specific bolded sub-points within sections
        const specificBoldPointsRegex = new RegExp(
            [
                'Redu√ß√£o de Riscos e Seguran√ßa Financeira', 'Facilidade de Controle e Gest√£o Financeira',
                'Flexibilidade e Adaptabilidade √†s Necessidades', 'Melhoria no Fluxo de Caixa e Antecipa√ß√£o de Numer√°rio',
                'Comprovante Fiscal', 'Comprovante de Pagamento', 'Etiqueta', 'Bloqueio Preventivo',
                'Transa√ß√£o', 'Presta√ß√£o de Contas', 'Respons√°vel pela Presta√ß√£o de Contas',
                'Departamento Financeiro', 'Reincid√™ncia', 'Contesta√ß√£o', 'Revis√£o das Categorias Liberadas',
                'Portador Tempor√°rio', 'Sangrias de Caixa', 'Treinamento Obrigat√≥rio', 'Service Now',
                'Crit√©rios de Bloqueio do Cart√£o',
                'Transa√ß√µes de valor elevado', 'Transa√ß√µes de valor m√©dio', 'Transa√ß√µes de pequeno valor',
                'Tipo de Transa√ß√£o,Valor da Transa√ß√£o,Prazo para Regulariza√ß√£o,Medida Corretiva',
                'Marketplaces', 'Situa√ß√µes excepcionais e devidamente justificadas', 'Nota de Esclarecimento',
                'Anexa√ß√£o posterior', 'Utiliza√ß√£o provis√≥ria de cart√£o de outra loja'
            ].map(escapeRegExp).join('|'),
            'i'
        );
        const numberedSubPointRegex = /^(\d+\.\d+\.?)\s/;

        lines.forEach(line => {
            const trimmedLine = line.trim();
            if (trimmedLine === '') {
                if (currentParagraphLines.length > 0) {
                    htmlContent.push(`<p>${currentParagraphLines.join(' ').trim()}</p>`);
                    currentParagraphLines = [];
                }
                return;
            }

            let isFormatted = false;

            // Check for main section titles from the sectionToIdMap
            for (const canonicalTitle of mainSectionHeadings) {
                const titleRegex = new RegExp(`^(\\s*\\d+\\.?\\s*|\\s*)${escapeRegExp(canonicalTitle)}(\\s*|$)`, 'i');
                if (trimmedLine.match(titleRegex)) {
                    if (currentParagraphLines.length > 0) {
                        htmlContent.push(`<p>${currentParagraphLines.join(' ').trim()}</p>`);
                        currentParagraphLines = [];
                    }
                    htmlContent.push(`<h4 class="font-bold text-lg mt-6 mb-2 policy-title">${trimmedLine}</h4>`);
                    isFormatted = true;
                    break;
                }
            }
            
            // Check for specific bolded sub-points or numbered sub-points if not a main title
            if (!isFormatted && (specificBoldPointsRegex.test(trimmedLine) || numberedSubPointRegex.test(trimmedLine) || trimmedLine.startsWith('Tipo de Transa√ß√£o,Valor da Transa√ß√£o'))) {
                if (currentParagraphLines.length > 0) {
                    htmlContent.push(`<p>${currentParagraphLines.join(' ').trim()}</p>`);
                    currentParagraphLines = [];
                }
                const firstColonIndex = trimmedLine.indexOf(':');
                if (firstColonIndex !== -1 && trimmedLine.includes(' :')) {
                    const boldPart = trimmedLine.substring(0, firstColonIndex + 1);
                    const normalPart = trimmedLine.substring(firstColonIndex + 1).trim();
                    htmlContent.push(`<p class="mt-2"><strong class="policy-title">${boldPart}</strong> ${normalPart}</p>`);
                } else {
                    htmlContent.push(`<p class="mt-2"><strong class="policy-title">${trimmedLine}</strong></p>`);
                }
                isFormatted = true;
            }

            // Handle list items starting with '-'
            if (!isFormatted && trimmedLine.startsWith('- ')) {
                if (currentParagraphLines.length > 0) {
                    htmlContent.push(`<p>${currentParagraphLines.join(' ').trim()}</p>`);
                    currentParagraphLines = [];
                }
                htmlContent.push(`<p class="mt-2">${trimmedLine}</p>`);
                isFormatted = true;
            }

            // If none of the above, it's regular paragraph text
            if (!isFormatted) {
                currentParagraphLines.push(trimmedLine);
            }
        });

        // Add any remaining paragraph lines
        if (currentParagraphLines.length > 0) {
            htmlContent.push(`<p>${currentParagraphLines.join(' ').trim()}</p>`);
        }
        
        let finalHtml = htmlContent.join('');
        if (queryToHighlight) {
            finalHtml = finalHtml.replace(
                new RegExp(escapeRegExp(queryToHighlight), 'gi'),
                match => `<span class="policy-content-highlight">${match}</span>`
            );
        }
        return finalHtml;
    }

    // New function to render a specific section with formatting and highlighting
    function renderSpecificSectionContent(sectionTitle, queryToHighlight) {
        const sectionData = parsedPolicySections[sectionTitle];
        if (!sectionData || !sectionData.rawContent) {
            return `<p>Conte√∫do da se√ß√£o "${sectionTitle}" n√£o encontrado.</p>`;
        }
        return formatPolicyText(sectionData.rawContent, queryToHighlight);
    }

    // Parse the policy content into sections when the DOM is ready
    parsePolicyIntoSections();

    // Render the full policy document initially
    policyTextRendered.innerHTML = formatPolicyText(policyDocumentContent);
    document.querySelector('#fullPolicyContentDisplay h3').textContent = 'Documento Completo da Pol√≠tica';


    documentSearchBtn.addEventListener('click', () => {
        const query = documentSearchInput.value.trim();
        if (!query) {
            searchStatus.textContent = 'Por favor, digite um termo para buscar.';
            documentSearchResults.innerHTML = '';
            // Ensure fullPolicyContentDisplay is hidden and documentSearchArea is shown when search is empty
            fullPolicyContentDisplay.classList.add('hidden');
            documentSearchArea.classList.remove('hidden');
            return;
        }

        searchLoadingIndicator.classList.remove('hidden');
        searchStatus.textContent = 'Buscando...';
        documentSearchResults.innerHTML = '';

        const results = [];
        const lowerCaseContent = policyDocumentContent.toLowerCase();
        const lowerCaseQuery = query.toLowerCase();
        let startIndex = 0;

        while ((startIndex = lowerCaseContent.indexOf(lowerCaseQuery, startIndex)) > -1) {
            let foundSectionTitle = 'Introdu√ß√£o ao Documento'; // Default if no specific section is found
            
            // Find the section this match belongs to using the structuredPolicy
            const sectionsKeys = Object.keys(parsedPolicySections);
            for (let i = sectionsKeys.length - 1; i >= 0; i--) {
                const sectionTitleKey = sectionsKeys[i];
                const section = parsedPolicySections[sectionTitleKey];
                
                if (startIndex >= section.startCharIndex && startIndex < section.endCharIndex) {
                    foundSectionTitle = sectionTitleKey;
                    break;
                }
            }

            // Get a snippet for display in the search results list (e.g., the sentence containing the match)
            const snippetStart = Math.max(
                0,
                policyDocumentContent.lastIndexOf('.', startIndex - 1) + 1,
                policyDocumentContent.lastIndexOf('\n', startIndex - 1) + 1,
                policyDocumentContent.lastIndexOf(':', startIndex - 1) + 1
            );
            const tempSnippetEnd = policyDocumentContent.indexOf('.', startIndex + query.length);
            const tempNewlineEnd = policyDocumentContent.indexOf('\n', startIndex + query.length);
            const tempColonEnd = policyDocumentContent.indexOf(':', startIndex + query.length);

            let snippetEndCandidate = policyDocumentContent.length;
            if (tempSnippetEnd !== -1) snippetEndCandidate = Math.min(snippetEndCandidate, tempSnippetEnd);
            if (tempNewlineEnd !== -1) snippetEndCandidate = Math.min(snippetEndCandidate, tempNewlineEnd);
            if (tempColonEnd !== -1) snippetEndCandidate = Math.min(snippetEndCandidate, tempColonEnd);

            const actualSnippetEnd = (snippetEndCandidate === policyDocumentContent.length) ? policyDocumentContent.length : snippetEndCandidate + 1;

            let displaySnippet = policyDocumentContent.substring(snippetStart, actualSnippetEnd).trim();
            if (displaySnippet.length < 50 && actualSnippetEnd === policyDocumentContent.length) {
                 displaySnippet = policyDocumentContent.substring(snippetStart, Math.min(policyDocumentContent.length, snippetStart + 150)).trim();
            }

            const highlightedSnippetForDisplay = displaySnippet.replace(new RegExp(escapeRegExp(query), 'gi'), match => `<strong class="bg-yellow-200 px-1 rounded">${match}</strong>`);
            
            results.push({
                snippetForDisplay: highlightedSnippetForDisplay,
                sectionTitle: foundSectionTitle,
                originalQuery: query,
            });
            
            startIndex += query.length;
        }

        searchLoadingIndicator.classList.add('hidden');
        if (results.length > 0) {
            searchStatus.textContent = `Encontrado ${results.length} resultado(s) para "${query}":`;
            results.forEach((result, index) => {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'p-3 border border-slate-200 rounded-lg bg-slate-50 search-result-item';
                // Removed click event listener: // resultDiv.addEventListener('click', function() { ... });
                resultDiv.innerHTML = `<p class="text-sm text-slate-700"><strong>${result.sectionTitle}:</strong> ${result.snippetForDisplay}</p>`;
                documentSearchResults.appendChild(resultDiv);
            });
            // When search results are displayed, the fullPolicyContentDisplay should be hidden
            fullPolicyContentDisplay.classList.add('hidden');
            documentSearchArea.classList.remove('hidden');

        } else {
            searchStatus.textContent = `Nenhum resultado encontrado para "${query}".`;
            fullPolicyContentDisplay.classList.add('hidden');
            documentSearchArea.classList.remove('hidden');
        }
    });

    // Back to Search button functionality (this button should always be visible IF fullPolicyContentDisplay is visible)
    backToSearchBtn.addEventListener('click', () => {
        fullPolicyContentDisplay.classList.add('hidden');
        documentSearchArea.classList.remove('hidden');
        documentSearchResults.innerHTML = '';
        documentSearchInput.value = '';
        searchStatus.textContent = 'Documento da pol√≠tica carregado e pronto para busca.';
        // Reset the display to the full policy document when returning from a specific section view
        policyTextRendered.innerHTML = formatPolicyText(policyDocumentContent);
        document.querySelector('#fullPolicyContentDisplay h3').textContent = 'Documento Completo da Pol√≠tica';
    });

    // Initial state setup for the "Pesquisa no Documento" section
    // Ensure the "Voltar √† Pesquisa" button is only visible when fullPolicyContentDisplay is active
    const observerForButtonVisibility = new MutationObserver(mutations => {
        mutations.forEach(mutation => {
            if (mutation.attributeName === 'class') {
                if (fullPolicyContentDisplay.classList.contains('hidden')) {
                    backToSearchBtn.style.display = 'none';
                } else {
                    backToSearchBtn.style.display = 'inline-block'; // Or 'block' depending on desired layout
                }
            }
        });
    });
    observerForButtonVisibility.observe(fullPolicyContentDisplay, { attributes: true });

    // Initial check for button visibility on load
    if (fullPolicyContentDisplay.classList.contains('hidden')) {
        backToSearchBtn.style.display = 'none';
    } else {
        backToSearchBtn.style.display = 'inline-block';
    }


});
</script>

</body>
</html>
