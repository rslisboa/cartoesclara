<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Assistente Clara | Uso do Cart√£o na Loja</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonte -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap"
        rel="stylesheet"
    />

    <style>
        body {
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
            background-color: #f8fafc;
        }

        /* bolhas */
        .user-bubble {
            background-color: #0ea5e9; /* sky-500 */
            color: #fff;
            border-radius: 1rem;
            border-bottom-right-radius: 0.25rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.25);
        }
        .bot-bubble {
            background-color: #ffffff;
            border-radius: 1rem;
            border-bottom-left-radius: 0.25rem;
            border: 1px solid rgb(226 232 240 / 1); /* slate-200 */
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07);
        }

        /* avatar Clara */
        .bot-avatar {
            background-color: #0ea5e9;
            color: #fff;
        }

        /* "digitando..." */
        .typing-bubble {
            background-color: #ffffff;
            border-radius: 1rem;
            border-bottom-left-radius: 0.25rem;
            border: 1px solid rgb(226 232 240 / 1);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07);
            font-size: 13px;
            color: #475569;
        }
        .dot {
            width: 6px;
            height: 6px;
            background-color: #475569;
            border-radius: 9999px;
            display: inline-block;
            animation: bounce 1.2s infinite;
        }
        .dot:nth-child(2) { animation-delay: 0.15s; }
        .dot:nth-child(3) { animation-delay: 0.3s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: translateY(0); opacity: 0.4; }
            40% { transform: translateY(-4px); opacity: 1; }
        }

        /* esconder scroll feio no chat */
        #chatWindow::-webkit-scrollbar {
            width: 6px;
        }
        #chatWindow::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 9999px;
        }
        #chatWindow::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 9999px;
        }
    </style>
</head>
<body class="text-slate-800 flex items-center justify-center min-h-screen p-4">

    <main class="w-full max-w-4xl bg-white rounded-2xl shadow-xl border border-slate-200 flex flex-col max-h-[90vh]">
        <!-- Header -->
        <header class="px-5 py-4 border-b border-slate-200 flex flex-col md:flex-row md:items-start md:justify-between gap-4">
            <div class="flex items-start gap-3">
                <div class="w-12 h-12 rounded-xl bot-avatar flex items-center justify-center font-bold text-lg shadow-md">
                    C
                </div>
                <div class="leading-tight">
                    <p class="font-semibold text-slate-800 text-base md:text-lg">
                        Assistente Clara | Grupo SBF
                    </p>
                    <p class="text-[12px] text-slate-500">
                        Pergunte sobre o uso do cart√£o Clara nas lojas. Eu respondo baseado na pol√≠tica atual.
                    </p>
                    <p class="text-[11px] text-slate-400 italic mt-1">
                        Ex: "Posso comprar micro-ondas?" ‚Ä¢ "Uber pode?" ‚Ä¢ "Travou o cart√£o, fa√ßo o qu√™?"
                    </p>
                </div>
            </div>

            <div class="text-[11px] text-slate-500 leading-snug md:text-right">
                <p class="font-semibold text-slate-700">Prazo de presta√ß√£o de contas:</p>
                <p>At√© 48h pra anexar nota fiscal, escolher etiqueta e descrever o gasto.</p>
                <p class="text-[10px] text-slate-400 mt-1">
                    Falha na presta√ß√£o no prazo pode bloquear o cart√£o preventivamente.
                </p>
            </div>
        </header>

        <!-- Chat janela -->
        <section id="chatWindow" class="flex-1 overflow-y-auto px-5 py-4 space-y-4 text-[15px] leading-relaxed bg-slate-50/40">

            <!-- Mensagem inicial da Clara -->
            <div class="flex items-start gap-3">
                <div class="w-9 h-9 rounded-xl bot-avatar flex items-center justify-center font-bold text-sm shadow-md flex-shrink-0">
                    C
                </div>
                <div class="bot-bubble px-4 py-3 max-w-[80%]">
                    <p class="font-semibold text-slate-800">
                        Ol√°! üëã Eu sou a Clara.
                    </p>
                    <p class="text-slate-700 text-sm mt-1">
                        Me pergunta coisas tipo:
                        <br>‚Ä¢ "Posso pagar Uber?"
                        <br>‚Ä¢ "Deu bloqueio, o que eu fa√ßo?"
                        <br>‚Ä¢ "Posso comprar √°gua pro time?"
                        <br>‚Ä¢ "Quanto tempo tenho pra subir a nota?"
                    </p>
                    <p class="text-[11px] text-slate-400 italic mt-3">
                        Minhas respostas seguem a Pol√≠tica de Uso dos Cart√µes Clara. Em conflito, vale sempre o documento oficial da empresa.
                    </p>
                </div>
            </div>
        </section>

        <!-- √Årea de input -->
        <section class="border-t border-slate-200 bg-white rounded-b-2xl px-4 py-4 flex flex-col gap-3">
            <form id="chatForm" class="flex w-full gap-3">
                <input
                    id="userInput"
                    type="text"
                    class="flex-1 text-[15px] border border-slate-300 rounded-xl px-3 py-3 outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500"
                    placeholder="Escreva sua d√∫vida (ex: posso comprar um micro-ondas para a sala de pausa?)"
                    autocomplete="off"
                />
                <button
                    class="bg-sky-500 hover:bg-sky-600 text-white font-semibold text-sm rounded-xl px-4 py-3 shadow-md transition"
                    type="submit"
                >
                    Enviar
                </button>
            </form>

            <div class="text-[11px] text-slate-500 text-center leading-snug">
            </div>
        </section>
    </main>

    <script>
        // Base de conhecimento (regras da pol√≠tica)
        // Cada entrada tem:
        //   intent: palavras-chave
        //   response: o texto que a Clara responde
        // Observa√ß√£o: linguagem direta / loja / sem juridiqu√™s pesado.

        const knowledgeBase = [
            {
                intent: ["micro-ondas", "microondas", "micro ondas", "geladeira", "frigobar", "cafeteira", "eletrodom√©stico", "eletrodomestico", "eletro domestico", "patrimonial", "patrim√¥nio", "patrimonio"],
                response: `
‚ùå N√£o pode comprar eletrodom√©stico (micro-ondas, geladeira, cafeteira, frigobar etc.) com o cart√£o Clara.
Isso √© considerado bem patrimonial / infraestrutura e deve seguir fluxo de Compras.

Se voc√™ j√° comprou com o cart√£o:
1. Informe imediatamente o Financeiro.
2. Classifique na plataforma como "Despesa Pessoal ‚Äì Uso Indevido".
3. Ressar√ßa o valor em at√© 2 dias √∫teis.

Se n√£o ressarcir, a empresa pode aplicar desconto em folha (art. 462 da CLT) e bloquear definitivamente o cart√£o.`
            },
            {
                intent: ["uber", "99", "app de transporte", "taxi", "t√°xi", "corrida", "transporte pessoal", "viagem", "passagem"],
                response: `
‚ùå N√£o pode usar o cart√£o Clara para Uber / 99 / t√°xi / transporte de pessoas ou deslocamento pessoal.
Isso n√£o √© gasto operacional direto da loja.

Se j√° usou: avise o Financeiro e fa√ßa o ressarcimento.`
            },
            {
                intent: ["lanche", "caf√©", "cafe", "refei√ß√£o", "refeicao", "almo√ßo", "almoco", "pizza", "refrigerante", "coffee break", "time", "vm", "treinamento", "equipe", "√°gua", "agua", "bebida", "snack", "lanche do time"],
                response: `
üåü Pode em alguns casos, mas tem regra.

√â permitido usar o cart√£o para itens como √°gua pot√°vel, caf√©, lanche ou coffee break SOMENTE quando for para:
‚Ä¢ treinamento interno autorizado,
‚Ä¢ a√ß√£o interna oficial na loja (ex.: VM, regional, diretoria),
‚Ä¢ evento operacional aprovado.

N√£o √© permitido pagar almo√ßo pessoal, pipoca no cinema, comida de lazer etc.

Como lan√ßar:
‚Ä¢ Anexar a nota fiscal.
‚Ä¢ Escolher a etiqueta correta.
‚Ä¢ Descrever claramente: "Coffee break treinamento VM loja 1234".`
            },
            {
                intent: ["bloqueou", "bloqueio", "bloqueada", "cart√£o bloqueado", "cartao bloqueado", "desbloquear", "travou", "travou meu cart√£o", "preventivo", "cart√£o travou"],
                response: `
üîí Bloqueio preventivo acontece quando a compra n√£o foi corretamente justificada dentro do prazo de 48 horas.

O que √© justificar?
‚Ä¢ Anexar a nota fiscal/recibo,
‚Ä¢ Escolher a etiqueta correta,
‚Ä¢ Preencher a descri√ß√£o dizendo o que foi comprado e por qu√™.

Passos:
1. Regularize tudo na plataforma Clara.
2. Abra chamado para o Financeiro (Contas a Receber / ServiceNow) pedindo o desbloqueio.

Importante:
O cart√£o pode ser bloqueado preventivamente independente do valor da compra.
Reincid√™ncia pode fazer a loja perder o direito de uso do cart√£o.`
            },
            {
                intent: ["48h", "48 horas", "prazo", "tempo para lan√ßar", "quanto tempo tenho", "justificar", "prestar conta", "presta√ß√£o de contas", "prestacao de contas", "nota fiscal prazo", "deadline"],
                response: `
‚è± Prazo oficial:
Voc√™ tem at√© 48 horas depois da compra para:
‚Ä¢ anexar a nota fiscal / recibo,
‚Ä¢ escolher a etiqueta correta,
‚Ä¢ escrever a descri√ß√£o explicando o motivo do gasto.

Se n√£o fizer isso no prazo, o cart√£o pode ser bloqueado preventivamente at√© voc√™ regularizar.

Obs: esse bloqueio pode ocorrer mesmo em compras de baixo valor.`
            },
            {
                intent: ["permitido", "pode comprar", "posso comprar", "√© permitido", "permitida", "usar o cart√£o", "usar o cartao", "uso do cart√£o", "uso do cartao", "o que pode"],
                response: `
‚úÖ Uso permitido do cart√£o Clara (exemplos comuns):
‚Ä¢ material de limpeza
‚Ä¢ √°gua pot√°vel e itens b√°sicos de copa para a loja
‚Ä¢ material de escrit√≥rio
‚Ä¢ servi√ßo gr√°fico / adesivo / banner / material promocional local
‚Ä¢ pequenos reparos e manuten√ß√µes simples (ex.: chaveiro emergencial, troca de tomada, ajuste leve em equipamento da loja)
‚Ä¢ motoboy / frete emergencial entre lojas para manter opera√ß√£o

‚ö† Sempre:
- anexar nota fiscal,
- etiqueta correta,
- descri√ß√£o objetiva ("Chaveiro emergencial - troca de fechadura estoque loja 1234").`
            },
            {
                intent: ["gasto pessoal", "uso pessoal", "comprei pra mim", "coisa minha", "roupa pro meu filho", "pessoal", "despesa pessoal"],
                response: `
‚ö† Uso pessoal do cart√£o √© proibido.

Se voc√™ mesmo reconhece que foi pessoal:
1. Avise imediatamente o Financeiro.
2. Classifique na Clara como "Despesa Pessoal ‚Äì Uso Indevido".
3. Ressar√ßa o valor em at√© 2 dias √∫teis.

Se voc√™ N√ÉO reconhecer ou n√£o ressarcir:
‚Ä¢ A empresa pode aplicar desconto em folha (art. 462 CLT),
‚Ä¢ Abrir processo disciplinar,
‚Ä¢ Bloquear definitivamente o cart√£o.`
            },
            {
                intent: ["emerg√™ncia", "emergencial", "urgente", "sangria", "tirar dinheiro do caixa", "caixa", "sem limite", "estourou limite", "n√£o tenho limite", "nao tenho limite", "acabou limite"],
                response: `
üö® Emerg√™ncia n√£o √© "acabou meu limite".

√â emerg√™ncia verdadeira quando:
1. A loja n√£o consegue operar sem aquele gasto imediato
E
2. N√£o d√° pra pagar com o cart√£o Clara naquele momento (ex.: problema t√©cnico s√©rio).

Nesses casos:
‚Üí Voc√™ precisa pedir autoriza√ß√£o PR√âVIA do Financeiro (via ServiceNow).
‚Üí Sem autoriza√ß√£o pr√©via, N√ÉO pode tirar dinheiro do caixa da loja ‚Äús√≥ pra resolver r√°pido‚Äù.

Isso protege voc√™ e a loja.`
            },
            {
                intent: ["nota f√≠sica", "nota fisica", "nota fiscal f√≠sica", "guardar nota", "guardar comprovante", "auditoria", "180 dias", "guardar 180 dias", "comprovante f√≠sico", "comprovante fisico"],
                response: `
üìÑ Guarda de comprovantes:
Mesmo depois de anexar a nota fiscal/recibo na plataforma Clara,
a loja precisa guardar o documento f√≠sico original por pelo menos 180 dias corridos.

Auditoria pode pedir esse documento f√≠sico.`
            },
            {
                intent: ["cart√£o de outra loja", "cartao de outra loja", "usar cart√£o de outra loja", "cart√£o emprestado", "cartao emprestado", "gerente desligado", "sem gerente", "sem cart√£o", "sem cartao"],
                response: `
Uso de cart√£o de outra loja pode ser autorizado SOMENTE em uma situa√ß√£o espec√≠fica:
‚Ä¢ O gerente titular saiu / est√° desligado,
‚Ä¢ Ainda n√£o existe cart√£o novo para a loja,
‚Ä¢ O Financeiro autorizou o uso tempor√°rio.

Obrigat√≥rio na descri√ß√£o da compra:
"Uso tempor√°rio do cart√£o na loja XXXX"

Sem essa autoriza√ß√£o pr√©via ‚Üí n√£o pode usar cart√£o de outra loja.`
            }
        ];

        // fallback gen√©rico caso a pergunta n√£o bata com nenhuma inten√ß√£o
        const fallbackAnswer = `
Vamos fazer certo üëá

1. Essa compra √© para opera√ß√£o da LOJA ou √© algo pessoal?
2. Voc√™ tem (ou vai ter) nota fiscal?
3. Vai conseguir lan√ßar etiqueta + nota + descri√ß√£o em at√© 48h?

Me conta isso rapidinho e eu j√° te digo se √© permitido usar o cart√£o Clara ou n√£o.`;

        // utilidade: normaliza texto do usu√°rio
        function normalize(text) {
            return text
                .toLowerCase()
                .normalize("NFD")
                .replace(/[\u0300-\u036f]/g, ""); // remove acento
        }

        // tenta achar resposta na base
        function findAnswer(userMessage) {
            const msg = normalize(userMessage);

            for (const entry of knowledgeBase) {
                for (const keyword of entry.intent) {
                    const normKey = normalize(keyword);
                    if (msg.includes(normKey)) {
                        return entry.response.trim();
                    }
                }
            }
            return fallbackAnswer.trim();
        }

        // DOM refs
        const chatWindow = document.getElementById("chatWindow");
        const chatForm = document.getElementById("chatForm");
        const userInput = document.getElementById("userInput");

        // render bolha do usu√°rio
        function renderUserMessage(text) {
            const wrapper = document.createElement("div");
            wrapper.className = "flex items-start gap-3 justify-end";

            const bubble = document.createElement("div");
            bubble.className = "user-bubble px-4 py-3 max-w-[80%] text-sm whitespace-pre-line";
            bubble.innerText = text;

            wrapper.appendChild(bubble);
            chatWindow.appendChild(wrapper);
        }

        // render "Clara digitando..."
        function renderTyping() {
            const wrapper = document.createElement("div");
            wrapper.className = "flex items-start gap-3 clara-typing";

            const avatar = document.createElement("div");
            avatar.className = "w-9 h-9 rounded-xl bot-avatar flex items-center justify-center font-bold text-sm shadow-md flex-shrink-0";
            avatar.innerText = "C";

            const bubble = document.createElement("div");
            bubble.className = "typing-bubble px-4 py-3 max-w-[80%] text-[13px]";
            bubble.innerHTML = `
                <span class="dot"></span>
                <span class="dot ml-1"></span>
                <span class="dot ml-1"></span>
                <span class="ml-2 text-slate-500">digitando...</span>
            `;

            wrapper.appendChild(avatar);
            wrapper.appendChild(bubble);

            chatWindow.appendChild(wrapper);
            scrollToBottom();

            return wrapper; // devolve pra conseguir remover depois
        }

        // render resposta da Clara
        function renderBotMessage(text) {
            const wrapper = document.createElement("div");
            wrapper.className = "flex items-start gap-3";

            const avatar = document.createElement("div");
            avatar.className = "w-9 h-9 rounded-xl bot-avatar flex items-center justify-center font-bold text-sm shadow-md flex-shrink-0";
            avatar.innerText = "C";

            const bubble = document.createElement("div");
            bubble.className = "bot-bubble px-4 py-3 max-w-[80%] text-sm whitespace-pre-line text-slate-700";
            bubble.innerText = text;

            wrapper.appendChild(avatar);
            wrapper.appendChild(bubble);

            chatWindow.appendChild(wrapper);
        }

        function scrollToBottom() {
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        // submit handler
        chatForm.addEventListener("submit", function (e) {
            e.preventDefault();
            const text = userInput.value.trim();
            if (!text) return;

            // mostra msg user
            renderUserMessage(text);
            userInput.value = "";

            // Clara "digitando..."
            const typingEl = renderTyping();

            // gera resposta imediata
            const answer = findAnswer(text);

            // simula um pequeno atraso local s√≥ pra UX ficar natural
            setTimeout(() => {
                typingEl.remove();
                renderBotMessage(answer);
                scrollToBottom();
            }, 400);
        });
    </script>
</body>
</html>

