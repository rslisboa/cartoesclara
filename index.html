<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Assistente Clara | Uso do Cart√£o na Loja</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Fonte -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap"
        rel="stylesheet"
    />

    <style>
        body {
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
            background-color: #f8fafc;
        }

        /* bolhas */
        .user-bubble {
            background-color: #0ea5e9; /* sky-500 */
            color: #fff;
            border-radius: 1rem;
            border-bottom-right-radius: 0.25rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.25);
        }
        .bot-bubble {
            background-color: #ffffff;
            border-radius: 1rem;
            border-bottom-left-radius: 0.25rem;
            border: 1px solid rgb(226 232 240 / 1); /* slate-200 */
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07);
        }

        /* avatar Clara */
        .bot-avatar {
            background-color: #0ea5e9;
            color: #fff;
        }

        /* "digitando..." */
        .typing-bubble {
            background-color: #ffffff;
            border-radius: 1rem;
            border-bottom-left-radius: 0.25rem;
            border: 1px solid rgb(226 232 240 / 1);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.07);
            font-size: 13px;
            color: #475569;
        }
        .dot {
            width: 6px;
            height: 6px;
            background-color: #475569;
            border-radius: 9999px;
            display: inline-block;
            animation: bounce 1.2s infinite;
        }
        .dot:nth-child(2) { animation-delay: 0.15s; }
        .dot:nth-child(3) { animation-delay: 0.3s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: translateY(0); opacity: 0.4; }
            40% { transform: translateY(-4px); opacity: 1; }
        }

        /* scrollbar da janela de chat */
        #chatWindow::-webkit-scrollbar {
            width: 6px;
        }
        #chatWindow::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 9999px;
        }
        #chatWindow::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 9999px;
        }
    </style>
</head>
<body class="text-slate-800 flex items-center justify-center min-h-screen p-4">

    <main class="w-full max-w-4xl bg-white rounded-2xl shadow-xl border border-slate-200 flex flex-col max-h-[90vh]">
        <!-- Header -->
        <header class="px-5 py-4 border-b border-slate-200 flex flex-col md:flex-row md:items-start md:justify-between gap-4">
            <div class="flex items-start gap-3">
                <div class="w-12 h-12 rounded-xl bot-avatar flex items-center justify-center font-bold text-lg shadow-md">
                    C
                </div>
                <div class="leading-tight">
                    <p class="font-semibold text-slate-800 text-base md:text-lg">
                        Assistente Clara | Grupo SBF
                    </p>
                    <p class="text-[12px] text-slate-500">
                        Pergunte sobre o uso do cart√£o Clara nas lojas.
                    </p>
                    <p class="text-[11px] text-slate-400 italic mt-1">
                        Ex: "Posso comprar micro-ondas?" ‚Ä¢ "Uber pode?" ‚Ä¢ "Travou o cart√£o, fa√ßo o qu√™?"
                    </p>
                </div>
            </div>

            <div class="text-[11px] text-slate-500 leading-snug md:text-right">
                <p class="font-semibold text-slate-700">Prazo de presta√ß√£o de contas:</p>
                <p>At√© 48h pra anexar nota fiscal, escolher etiqueta e descrever o gasto.</p>
                <p class="text-[10px] text-slate-400 mt-1">
                    Falha na presta√ß√£o no prazo pode bloquear o cart√£o preventivamente.
                </p>
            </div>
        </header>

        <!-- Chat window -->
        <section id="chatWindow" class="flex-1 overflow-y-auto px-5 py-4 space-y-4 text-[15px] leading-relaxed bg-slate-50/40">

            <!-- Mensagem inicial da Clara -->
            <div class="flex items-start gap-3">
                <div class="w-9 h-9 rounded-xl bot-avatar flex items-center justify-center font-bold text-sm shadow-md flex-shrink-0">
                    C
                </div>
                <div class="bot-bubble px-4 py-3 max-w-[80%]">
                    <p class="font-semibold text-slate-800">
                        Ol√°! üëã Eu sou a Clara.
                    </p>
                    <p class="text-slate-700 text-sm mt-1">
                        Me pergunta coisas tipo:
                        <br>‚Ä¢ "Posso pagar Uber?"
                        <br>‚Ä¢ "Deu bloqueio, o que eu fa√ßo?"
                        <br>‚Ä¢ "Posso comprar √°gua pro time?"
                        <br>‚Ä¢ "Quanto tempo tenho pra subir a nota?"
                        <br>‚Ä¢ "Como abro chamado no ServiceNow?"
                        <br>‚Ä¢ "Me manda a pol√≠tica em PDF."
                    </p>
                    <p class="text-[11px] text-slate-400 italic mt-3">
                        Minhas respostas seguem a Pol√≠tica de Uso dos Cart√µes Clara (24/06/2025). Em conflito, vale sempre o documento oficial da empresa.
                    </p>
                </div>
            </div>
        </section>

        <!-- √Årea de input -->
        <section class="border-t border-slate-200 bg-white rounded-b-2xl px-4 py-4 flex flex-col gap-3">
            <form id="chatForm" class="flex w-full gap-3">
                <input
                    id="userInput"
                    type="text"
                    class="flex-1 text-[15px] border border-slate-300 rounded-xl px-3 py-3 outline-none focus:ring-2 focus:ring-sky-500 focus:border-sky-500"
                    placeholder="Escreve sua d√∫vida (ex: Como pe√ßo desbloqueio no ServiceNow?)"
                    autocomplete="off"
                />
                <button
                    class="bg-sky-500 hover:bg-sky-600 text-white font-semibold text-sm rounded-xl px-4 py-3 shadow-md transition"
                    type="submit"
                >
                    Enviar
                </button>
            </form>

            <div class="text-[11px] text-slate-500 text-center leading-snug">
                Uso pessoal = proibido. Se acontecer, precisa informar, classificar como ‚ÄúDespesa Pessoal ‚Äì Uso Indevido‚Äù
                e ressarcir em at√© 2 dias √∫teis. Se n√£o ressarcir, pode ter desconto em folha (art. 462 CLT) e bloqueio definitivo do cart√£o.
            </div>
        </section>
    </main>

    <script>
        //
        // CONFIGURA√á√ïES FIXAS DO ASSISTENTE
        //

        // Link do ServiceNow interno da empresa
        // (coloque aqui o link certo do portal de chamados da sua empresa)
        const SERVICE_NOW_URL = "https://sn.gruposbf.com.br/sp?id=ticket&is_new_order=true&table=incident&sys_id=52d2e0ef1b06e1907540a6cae54bcbe6"; 

        // Link do PDF oficial da pol√≠tica
        const POLITICA_PDF_URL = "https://drive.google.com/file/d/1pDftfaJOPUra0-0gAeK2ziJ3llyscvjx/view?usp=sharing";


        //
        // 1. Palavras-chave por categoria de inten√ß√£o
        //

        const categorias = {
            eletronicos: [
                "ps5","playstation","play station","xbox",
                "tv","televisao","televis√£o","monitor","som","r√°dio","radio",
                "caixa de som","soundbar","notebook","laptop","tablet","fone","headset"
            ],
            eletrodomesticos: [
                "micro-ondas","microondas","micro ondas",
                "geladeira","frigobar","cafeteira","cafeteria","cafeteirinha",
                "bebedouro","airfryer","aspirador"
            ],
            alimentosEquipe: [
                "lanche","cafe","caf√©","refei√ß√£o","refeicao","almo√ßo","almoco","pizza","refrigerante",
                "√°gua","agua","coffee break","lanche do time","lanche da equipe",
                "time vm","vm","treinamento","treinamento interno","visita diretor","visita regional"
            ],
            transporte: [
                "uber","99","app de transporte","corrida","taxi","t√°xi","viagem","passagem","passagens"
            ],
            manutencaoLoja: [
                "chaveiro","fechadura","troca de tomada","tomada","manuten√ß√£o ar",
                "manutencao ar","ar condicionado","ar-condicionado","conserto geladeira da loja",
                "arrumar porta","arrumar vitrine","motoboy","frete","frete urgente","entrega urgente","courier"
            ],
            bloqueio: [
                "bloqueou","bloqueio","bloqueada",
                "cart√£o bloqueado","cartao bloqueado","desbloquear",
                "travou","cart√£o travou","cartao travou","preventivo","desbloqueio"
            ],
            prazo: [
                "48h","48 horas","prazo","quanto tempo","deadline",
                "prestar contas","presta√ß√£o de contas","prestacao de contas","justificar compra","quando preciso lan√ßar","ate quando lan√ßo"
            ],
            emergencial: [
                "emerg√™ncia","emergencia","urgente","sangria",
                "tirar dinheiro do caixa","pegar dinheiro do caixa","sem limite","acabou limite","limite acabou","estourou limite"
            ],
            pessoal: [
                "usei pra mim","pra mim","comprei pra mim",
                "gasto pessoal","despesa pessoal","roupa pro meu filho","comprei um body pro meu filho","pessoal"
            ],
            outraLoja: [
                "cart√£o de outra loja","cartao de outra loja","emprestado",
                "usar cart√£o da outra loja","usar cartao da outra loja",
                "gerente desligado","sem gerente","sem cart√£o","sem cartao","mudan√ßa de gerente","mudanca de gerente","troca de gerente"
            ],
            notaFiscal: [
                "guardar nota","nota fisica","nota fiscal fisica","nota fiscal f√≠sica",
                "comprovante fisico","comprovante f√≠sico","auditoria","180 dias","guardar comprovante"
            ],

            // NOVA: perguntas sobre ServiceNow / abertura de chamado
            servicenow: [
                "servicenow","service now","abre chamado","abrir chamado","abrir um chamado",
                "chamado de aumento de limite","chamado de limite","chamado desbloqueio",
                "desbloqueio no servicenow","categoria nova","nova etiqueta","nova categoria",
                "troca de gerente","mudan√ßa de gerente","mudanca de gerente","transferir gerente",
                "cart√£o bloqueado preciso abrir chamado","cartao bloqueado preciso abrir chamado",
                "o que posso abrir no servicenow","quais chamados posso abrir"
            ],

            // NOVA: pedir o PDF da pol√≠tica
            politicaPdf: [
                "me manda a pol√≠tica","me manda a politica","manda a pol√≠tica","manda a politica",
                "pdf da politica","pdf da pol√≠tica","politica clara","pol√≠tica clara",
                "documento oficial","politica completa","politica em pdf","politica de uso"
            ]
        };


        //
        // 2. Respostas humanas por inten√ß√£o
        //

        function respostaEletronicos() {
            return (
`N√£o, esse tipo de compra n√£o pode ser feito com o cart√£o Clara. üò¨

Itens como videogame (PS5), TV, r√°dio, caixa de som, notebook etc. s√£o considerados eletr√¥nico / bem patrimonial da empresa. Isso segue fluxo de Compras, n√£o cart√£o da loja.

Caminho certo:
‚Üí Solicitar via Compras / ServiceNow, n√£o passar direto no cart√£o Clara.`
            );
        }

        function respostaEletrodomesticos() {
            return (
`Micro-ondas, geladeira, frigobar, cafeteira, bebedouro... tamb√©m n√£o entram no cart√£o Clara.

Esses itens s√£o considerados infraestrutura/equipamento fixo de loja e precisam seguir o fluxo de Compras.

‚ö† Se j√° passou no cart√£o sem querer:
1. avisa o Financeiro,
2. classifica na plataforma como "Despesa Pessoal ‚Äì Uso Indevido",
3. faz o ressarcimento em at√© 2 dias √∫teis.`
            );
        }

        function respostaAlimentosEquipe() {
            return (
`Depende üëá

‚úî Pode:
Lanche / √°gua / caf√© / coffee break para treinamento interno autorizado, a√ß√£o oficial na loja (VM, regional, diretoria) ou evento operacional aprovado.

‚ùå N√£o pode:
Almo√ßo pessoal, pipoca no cinema, comida de lazer.

Quando pode, tem que lan√ßar assim:
‚Ä¢ Anexa a nota fiscal
‚Ä¢ Usa a etiqueta correta
‚Ä¢ Descreve: "Coffee break treinamento VM loja 1234".`
            );
        }

        function respostaTransporte() {
            return (
`Uber / 99 / t√°xi pra deslocamento pessoal n√£o pode no cart√£o Clara.

Isso n√£o √© despesa operacional direta da loja.

Se j√° pagou com o cart√£o:
‚Üí avisa Financeiro
‚Üí ressarce o valor.`
            );
        }

        function respostaManutencao() {
            return (
`Esses gastos normalmente PODEM ir no cart√£o Clara, porque s√£o operacionais da loja. üí°

Exemplos aceit√°veis:
‚Ä¢ chaveiro emergencial (trocar fechadura de estoque/cofre/vitrine),
‚Ä¢ troca de tomada simples,
‚Ä¢ reparo leve de ar-condicionado,
‚Ä¢ motoboy / frete urgente pra levar item cr√≠tico entre lojas.

Mas sempre:
- Nota fiscal anexada,
- Etiqueta correta,
- Descri√ß√£o clara: "Chaveiro emergencial - troca fechadura estoque loja 1234".`
            );
        }

        function respostaBloqueio() {
            return (
`Isso √© bloqueio preventivo. üîí

O cart√£o pode travar se a compra n√£o foi prestada conta no prazo de 48h.

Prestar conta = anexar nota fiscal/recibo + escolher etiqueta correta + descrever o motivo da compra.

Pra resolver:
1. Corrige tudo na plataforma Clara,
2. Abre chamado no ServiceNow pedindo desbloqueio para o Financeiro / Contas a Receber.

Importante:
‚Üí Pode bloquear independente do valor.
‚Üí Se virar recorrente, a loja pode perder o direito de usar o cart√£o.`
            );
        }

        function respostaPrazo() {
            return (
`Prazo oficial ‚è±

Voc√™ tem at√© 48 horas depois da compra pra:
‚Ä¢ anexar nota fiscal/recibo,
‚Ä¢ escolher a etiqueta certa,
‚Ä¢ escrever a descri√ß√£o explicando o motivo do gasto.

Se passar disso, o cart√£o pode ser bloqueado preventivamente at√© voc√™ regularizar.`
            );
        }

        function respostaEmergencia() {
            return (
`"Emerg√™ncia" N√ÉO √© "acabou o limite". üòÖ

√â emerg√™ncia real quando:
1. a loja n√£o consegue operar sem aquele gasto IMEDIATO
E
2. n√£o d√° pra pagar com o cart√£o Clara (ex.: pane t√©cnica).

Se isso acontecer:
‚Üí voc√™ precisa pedir autoriza√ß√£o PR√âVIA do Financeiro abrindo chamado no ServiceNow.
Sem essa autoriza√ß√£o, N√ÉO pode tirar dinheiro do caixa ‚Äús√≥ hoje‚Äù.`
            );
        }

        function respostaPessoal() {
            return (
`Uso pessoal do cart√£o √© proibido. Mas tem como corrigir se voc√™ assumir imediatamente.

Passo a passo:
1. avisa o Financeiro,
2. marca na plataforma como "Despesa Pessoal ‚Äì Uso Indevido",
3. devolve o valor em at√© 2 dias √∫teis.

Se voc√™ n√£o ressarcir:
‚Ä¢ pode ter desconto em folha (art. 462 CLT),
‚Ä¢ pode gerar medida disciplinar,
‚Ä¢ e o cart√£o pode ser bloqueado definitivamente.`
            );
        }

        function respostaOutraLoja() {
            return (
`Usar cart√£o de outra loja s√≥ pode em cen√°rio bem espec√≠fico:

‚Ä¢ O gerente titular saiu e ainda n√£o geraram um cart√£o novo pra loja,
‚Ä¢ O Financeiro autorizou o uso tempor√°rio,
‚Ä¢ E voc√™ est√° cobrindo.

Obrigat√≥rio:
Na descri√ß√£o da compra voc√™ escreve:
"Uso tempor√°rio do cart√£o na loja XXXX".

Se for uma mudan√ßa de gerente / transi√ß√£o de gest√£o entre lojas, tamb√©m √© algo que precisa ser avisado ao Financeiro via ServiceNow pra atualizar responsabilidade e controle.`
            );
        }

        function respostaNotaFiscal() {
            return (
`Mesmo depois de subir a nota fiscal na plataforma Clara, a loja precisa guardar o documento f√≠sico.

Prazo: manter guardado por 180 dias corridos. üóÇ
Auditoria pode pedir o original.`
            );
        }

        // NOVO: resposta geral sobre o ServiceNow
        function respostaServiceNowGeral() {
            return (
`Esses s√£o os casos que precisam de chamado no ServiceNow üëá

‚Ä¢ Desbloqueio do cart√£o Clara
  ‚Üí Tipo de chamado: Financeiro / Contas a Receber
  ‚Üí Motivo: "Cart√£o bloqueado - regulariza√ß√£o feita na Clara, solicitar libera√ß√£o"

‚Ä¢ Aumento de limite
  ‚Üí Tipo de chamado: Financeiro
  ‚Üí Motivo: "Solicita√ß√£o de ajuste de limite para despesas operacionais"

‚Ä¢ Troca de gerente / mudan√ßa de respons√°vel pelo cart√£o entre lojas
  ‚Üí Tipo de chamado: Cadastro / Financeiro
  ‚Üí Motivo: "Atualiza√ß√£o de respons√°vel pelo cart√£o e unidade"

‚Ä¢ Cria√ß√£o de nova categoria / etiqueta de gasto que n√£o existe ainda na Clara
  ‚Üí Tipo de chamado: Financeiro / Cont√°bil
  ‚Üí Motivo: "Solicitar nova etiqueta de despesa operacional"

‚Ä¢ Situa√ß√£o emergencial em que n√£o √© poss√≠vel usar o cart√£o Clara e a loja precisa pagar algo essencial pra operar
  ‚Üí Tipo de chamado: Financeiro
  ‚Üí Motivo: "Autoriza√ß√£o pr√©via de exce√ß√£o operacional"

Link de abertura: ${SERVICE_NOW_URL}

Importante:
Abrir chamado ANTES de fazer gambiarra (ex.: tirar dinheiro do caixa ou comprar item fora da pol√≠tica).`
            );
        }

        // NOVO: resposta ServiceNow contextual (desbloqueio, etiqueta, gerente, etc.)
        function respostaServiceNowContextual(msgNorm) {
            // desbloqueio
            if (msgNorm.includes("desbloque") || msgNorm.includes("bloqueou") || msgNorm.includes("bloqueio") || msgNorm.includes("cartao travou") || msgNorm.includes("cartao bloqueado") ) {
                return (
`Seu cart√£o travou? üîí

1. Corrija na Clara o que faltou: anexa a nota fiscal, escolhe a etiqueta certa e escreve a descri√ß√£o do gasto.
2. Depois abre um chamado no ServiceNow para o Financeiro / Contas a Receber.

No chamado, descreve:
"Cart√£o bloqueado preventivamente. Presta√ß√£o de contas regularizada. Solicito desbloqueio."

Link: ${SERVICE_NOW_URL}`
                );
            }

            // nova etiqueta / categoria
            if (msgNorm.includes("etiqueta") || msgNorm.includes("categoria nova") || msgNorm.includes("nova categoria")) {
                return (
`Quer usar uma categoria de gasto que n√£o existe ainda na Clara?

‚Üí Voc√™ precisa abrir um chamado no ServiceNow para o Financeiro / Cont√°bil
pedindo cria√ß√£o de nova etiqueta.

Escreve no chamado:
"Solicitar inclus√£o de etiqueta para despesa operacional da loja (descrever claramente o tipo de gasto)."

Link: ${SERVICE_NOW_URL}`
                );
            }

            // troca de gerente / mudan√ßa de respons√°vel
            if (msgNorm.includes("troca de gerente") || msgNorm.includes("mudanca de gerente") || msgNorm.includes("mudan√ßa de gerente") || msgNorm.includes("gerente desligado") || msgNorm.includes("sem gerente") ) {
                return (
`Mudou o gerente respons√°vel pelo cart√£o da loja?

‚Üí Precisa abrir chamado no ServiceNow para atualizar o respons√°vel oficial do cart√£o e garantir que a nova gest√£o esteja autorizada.

Descreve:
"Atualiza√ß√£o de respons√°vel pelo cart√£o Clara: gerente anterior desligado / novo respons√°vel assumindo a loja XXXX."

Isso garante controle e auditoria de quem presta contas.

Link: ${SERVICE_NOW_URL}`
                );
            }

            // aumento de limite
            if (msgNorm.includes("limite") || msgNorm.includes("aumento de limite") || msgNorm.includes("limite maior") ) {
                return (
`Precisa de aumento de limite do cart√£o?

‚Üí Abre chamado no ServiceNow para o Financeiro.

No chamado, descreve:
"Solicita√ß√£o de aumento de limite para despesas operacionais da loja XXXX. Justificativa: (explicar necessidade espec√≠fica)."

Lembrando: limite √© planejado mensal, n√£o √© pra cobrir gasto pessoal.

Link: ${SERVICE_NOW_URL}`
                );
            }

            // emerg√™ncia / exce√ß√£o autorizada
            if (msgNorm.includes("emergencia") || msgNorm.includes("emerg√™ncia") || msgNorm.includes("urgente") || msgNorm.includes("sangria") || msgNorm.includes("tirar dinheiro do caixa") || msgNorm.includes("pegar dinheiro do caixa")) {
                return (
`Situa√ß√£o emergencial real √© quando:
1. a loja n√£o consegue operar sem aquele gasto AGORA
e
2. n√£o tem como usar o cart√£o Clara.

Nessa situa√ß√£o:
‚Üí Voc√™ deve abrir chamado no ServiceNow pedindo autoriza√ß√£o PR√âVIA ao Financeiro.

No chamado, escreve:
"Solicita√ß√£o de exce√ß√£o emergencial para despesa operacional imediata. Motivo: (descrever risco operacional se n√£o pagar)."

Sem essa autoriza√ß√£o pr√©via, n√£o pode tirar dinheiro do caixa e 'resolver depois'.

Link: ${SERVICE_NOW_URL}`
                );
            }

            // fallback_serviceNow
            return respostaServiceNowGeral();
        }

        // NOVO: resposta pra "me manda a pol√≠tica / PDF"
        function respostaPoliticaPDF() {
            return (
`Segue a Pol√≠tica de Uso dos Cart√µes Clara (vers√£o oficial mais recente dispon√≠vel):

${POLITICA_PDF_URL}

Esse documento detalha:
‚Ä¢ categorias permitidas,
‚Ä¢ regras de presta√ß√£o de contas (48h),
‚Ä¢ bloqueio preventivo,
‚Ä¢ responsabilidades da loja e do Financeiro,
‚Ä¢ e o fluxo em caso de uso pessoal do cart√£o.`
            );
        }

        // fallback geral quando n√£o achou inten√ß√£o clara
        function respostaGenerica() {
            return (
`Vamos checar rapidinho üëá

1. A compra √© pra opera√ß√£o da LOJA ou √© algo pessoal?
2. Voc√™ tem/ter√° nota fiscal?
3. Voc√™ consegue anexar nota + escolher etiqueta + escrever o motivo em at√© 48h?

Se for gasto operacional da loja e voc√™ consegue justificar direitinho na Clara dentro de 48h, normalmente pode.
Se for item patrimonial (ex.: TV, PS5) ou pessoal, a√≠ n√£o pode no cart√£o Clara.`
            );
        }


        //
        // 3. Normaliza√ß√£o e classifica√ß√£o
        //

        function normalize(text) {
            return text
                .toLowerCase()
                .normalize("NFD")
                .replace(/[\u0300-\u036f]/g, ""); // tira acentos
        }

        function hit(msgNorm, arr) {
            return arr.some(k => msgNorm.includes(normalize(k)));
        }

        function classificarPergunta(msg) {
            const m = normalize(msg);

            if (hit(m, categorias.politicaPdf))   return "politicaPdf";
            if (hit(m, categorias.servicenow))    return "servicenow";

            if (hit(m, categorias.eletronicos))      return "eletronicos";
            if (hit(m, categorias.eletrodomesticos)) return "eletrodomesticos";
            if (hit(m, categorias.alimentosEquipe))  return "alimentosEquipe";
            if (hit(m, categorias.transporte))       return "transporte";
            if (hit(m, categorias.manutencaoLoja))   return "manutencaoLoja";
            if (hit(m, categorias.bloqueio))         return "bloqueio";
            if (hit(m, categorias.prazo))            return "prazo";
            if (hit(m, categorias.emergencial))      return "emergencia";
            if (hit(m, categorias.pessoal))          return "pessoal";
            if (hit(m, categorias.outraLoja))        return "outraLoja";
            if (hit(m, categorias.notaFiscal))       return "notaFiscal";

            return "generica";
        }


        //
        // 4. Gerar resposta baseada na inten√ß√£o
        //

        function gerarResposta(msg) {
            const tipo = classificarPergunta(msg);
            const msgNorm = normalize(msg);

            switch (tipo) {
                case "eletronicos":      return respostaEletronicos();
                case "eletrodomesticos": return respostaEletrodomesticos();
                case "alimentosEquipe":  return respostaAlimentosEquipe();
                case "transporte":       return respostaTransporte();
                case "manutencaoLoja":   return respostaManutencao();
                case "bloqueio":         return respostaBloqueio();
                case "prazo":            return respostaPrazo();
                case "emergencia":       return respostaEmergencia();
                case "pessoal":          return respostaPessoal();
                case "outraLoja":        return respostaOutraLoja();
                case "notaFiscal":       return respostaNotaFiscal();

                case "servicenow":       return respostaServiceNowContextual(msgNorm);
                case "politicaPdf":      return respostaPoliticaPDF();

                default:                 return respostaGenerica();
            }
        }


        //
        // 5. Renderiza√ß√£o do chat (UI)
        //

        const chatWindow = document.getElementById("chatWindow");
        const chatForm = document.getElementById("chatForm");
        const userInput = document.getElementById("userInput");

        function renderUserMessage(text) {
            const wrapper = document.createElement("div");
            wrapper.className = "flex items-start gap-3 justify-end";

            const bubble = document.createElement("div");
            bubble.className = "user-bubble px-4 py-3 max-w-[80%] text-sm whitespace-pre-line";
            bubble.innerText = text;

            wrapper.appendChild(bubble);
            chatWindow.appendChild(wrapper);
        }

        function renderTyping() {
            const wrapper = document.createElement("div");
            wrapper.className = "flex items-start gap-3 clara-typing";

            const avatar = document.createElement("div");
            avatar.className = "w-9 h-9 rounded-xl bot-avatar flex items-center justify-center font-bold text-sm shadow-md flex-shrink-0";
            avatar.innerText = "C";

            const bubble = document.createElement("div");
            bubble.className = "typing-bubble px-4 py-3 max-w-[80%] text-[13px]";
            bubble.innerHTML = `
                <span class="dot"></span>
                <span class="dot ml-1"></span>
                <span class="dot ml-1"></span>
                <span class="ml-2 text-slate-500">digitando...</span>
            `;

            wrapper.appendChild(avatar);
            wrapper.appendChild(bubble);

            chatWindow.appendChild(wrapper);
            scrollToBottom();

            return wrapper;
        }

        function renderBotMessage(text) {
            const wrapper = document.createElement("div");
            wrapper.className = "flex items-start gap-3";

            const avatar = document.createElement("div");
            avatar.className = "w-9 h-9 rounded-xl bot-avatar flex items-center justify-center font-bold text-sm shadow-md flex-shrink-0";
            avatar.innerText = "C";

            const bubble = document.createElement("div");
            bubble.className = "bot-bubble px-4 py-3 max-w-[80%] text-sm whitespace-pre-line text-slate-700";
            bubble.innerText = text;

            wrapper.appendChild(avatar);
            wrapper.appendChild(bubble);

            chatWindow.appendChild(wrapper);
        }

        function scrollToBottom() {
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }

        chatForm.addEventListener("submit", function (e) {
            e.preventDefault();
            const text = userInput.value.trim();
            if (!text) return;

            renderUserMessage(text);
            userInput.value = "";

            const typingEl = renderTyping();

            const answer = gerarResposta(text);

            setTimeout(() => {
                typingEl.remove();
                renderBotMessage(answer);
                scrollToBottom();
            }, 400);
        });
    </script>
</body>
</html>

